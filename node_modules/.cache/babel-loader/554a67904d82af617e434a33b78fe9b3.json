{"ast":null,"code":"'use strict';\n\nvar Tokenizer = require('../tokenizer'),\n    OpenElementStack = require('./open_element_stack'),\n    FormattingElementList = require('./formatting_element_list'),\n    LocationInfoParserMixin = require('../extensions/location_info/parser_mixin'),\n    defaultTreeAdapter = require('../tree_adapters/default'),\n    mergeOptions = require('../utils/merge_options'),\n    doctype = require('../common/doctype'),\n    foreignContent = require('../common/foreign_content'),\n    UNICODE = require('../common/unicode'),\n    HTML = require('../common/html'); //Aliases\n\n\nvar $ = HTML.TAG_NAMES,\n    NS = HTML.NAMESPACES,\n    ATTRS = HTML.ATTRS;\nvar DEFAULT_OPTIONS = {\n  locationInfo: false,\n  treeAdapter: defaultTreeAdapter\n}; //Misc constants\n\nvar HIDDEN_INPUT_TYPE = 'hidden'; //Adoption agency loops iteration count\n\nvar AA_OUTER_LOOP_ITER = 8,\n    AA_INNER_LOOP_ITER = 3; //Insertion modes\n\nvar INITIAL_MODE = 'INITIAL_MODE',\n    BEFORE_HTML_MODE = 'BEFORE_HTML_MODE',\n    BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE',\n    IN_HEAD_MODE = 'IN_HEAD_MODE',\n    AFTER_HEAD_MODE = 'AFTER_HEAD_MODE',\n    IN_BODY_MODE = 'IN_BODY_MODE',\n    TEXT_MODE = 'TEXT_MODE',\n    IN_TABLE_MODE = 'IN_TABLE_MODE',\n    IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE',\n    IN_CAPTION_MODE = 'IN_CAPTION_MODE',\n    IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE',\n    IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE',\n    IN_ROW_MODE = 'IN_ROW_MODE',\n    IN_CELL_MODE = 'IN_CELL_MODE',\n    IN_SELECT_MODE = 'IN_SELECT_MODE',\n    IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE',\n    IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE',\n    AFTER_BODY_MODE = 'AFTER_BODY_MODE',\n    IN_FRAMESET_MODE = 'IN_FRAMESET_MODE',\n    AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE',\n    AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE',\n    AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE'; //Insertion mode reset map\n\nvar INSERTION_MODE_RESET_MAP = Object.create(null);\nINSERTION_MODE_RESET_MAP[$.TR] = IN_ROW_MODE;\nINSERTION_MODE_RESET_MAP[$.TBODY] = INSERTION_MODE_RESET_MAP[$.THEAD] = INSERTION_MODE_RESET_MAP[$.TFOOT] = IN_TABLE_BODY_MODE;\nINSERTION_MODE_RESET_MAP[$.CAPTION] = IN_CAPTION_MODE;\nINSERTION_MODE_RESET_MAP[$.COLGROUP] = IN_COLUMN_GROUP_MODE;\nINSERTION_MODE_RESET_MAP[$.TABLE] = IN_TABLE_MODE;\nINSERTION_MODE_RESET_MAP[$.BODY] = IN_BODY_MODE;\nINSERTION_MODE_RESET_MAP[$.FRAMESET] = IN_FRAMESET_MODE; //Template insertion mode switch map\n\nvar TEMPLATE_INSERTION_MODE_SWITCH_MAP = Object.create(null);\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.CAPTION] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COLGROUP] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TBODY] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TFOOT] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.THEAD] = IN_TABLE_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COL] = IN_COLUMN_GROUP_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TR] = IN_TABLE_BODY_MODE;\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TD] = TEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TH] = IN_ROW_MODE; //Token handlers map for insertion modes\n\nvar _ = Object.create(null);\n\n_[INITIAL_MODE] = Object.create(null);\n_[INITIAL_MODE][Tokenizer.CHARACTER_TOKEN] = _[INITIAL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInInitialMode;\n_[INITIAL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[INITIAL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[INITIAL_MODE][Tokenizer.DOCTYPE_TOKEN] = doctypeInInitialMode;\n_[INITIAL_MODE][Tokenizer.START_TAG_TOKEN] = _[INITIAL_MODE][Tokenizer.END_TAG_TOKEN] = _[INITIAL_MODE][Tokenizer.EOF_TOKEN] = tokenInInitialMode;\n_[BEFORE_HTML_MODE] = Object.create(null);\n_[BEFORE_HTML_MODE][Tokenizer.CHARACTER_TOKEN] = _[BEFORE_HTML_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[BEFORE_HTML_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[BEFORE_HTML_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[BEFORE_HTML_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHtml;\n_[BEFORE_HTML_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHtml;\n_[BEFORE_HEAD_MODE] = Object.create(null);\n_[BEFORE_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[BEFORE_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\n_[BEFORE_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[BEFORE_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[BEFORE_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHead;\n_[BEFORE_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHead;\n_[IN_HEAD_MODE] = Object.create(null);\n_[IN_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInHead;\n_[IN_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagInHead;\n_[IN_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagInHead;\n_[IN_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenInHead;\n_[AFTER_HEAD_MODE] = Object.create(null);\n_[AFTER_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[AFTER_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[AFTER_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterHead;\n_[AFTER_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenAfterHead;\n_[IN_BODY_MODE] = Object.create(null);\n_[IN_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInBody;\n_[IN_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInBody;\n_[IN_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[TEXT_MODE] = Object.create(null);\n_[TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = _[TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[TEXT_MODE][Tokenizer.COMMENT_TOKEN] = _[TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] = _[TEXT_MODE][Tokenizer.START_TAG_TOKEN] = ignoreToken;\n_[TEXT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInText;\n_[TEXT_MODE][Tokenizer.EOF_TOKEN] = eofInText;\n_[IN_TABLE_MODE] = Object.create(null);\n_[IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTable;\n_[IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTable;\n_[IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TABLE_TEXT_MODE] = Object.create(null);\n_[IN_TABLE_TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = characterInTableText;\n_[IN_TABLE_TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_TABLE_TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInTableText;\n_[IN_TABLE_TEXT_MODE][Tokenizer.COMMENT_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.START_TAG_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.END_TAG_TOKEN] = _[IN_TABLE_TEXT_MODE][Tokenizer.EOF_TOKEN] = tokenInTableText;\n_[IN_CAPTION_MODE] = Object.create(null);\n_[IN_CAPTION_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_CAPTION_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_CAPTION_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_CAPTION_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_CAPTION_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_CAPTION_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCaption;\n_[IN_CAPTION_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCaption;\n_[IN_CAPTION_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_COLUMN_GROUP_MODE] = Object.create(null);\n_[IN_COLUMN_GROUP_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_COLUMN_GROUP_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.START_TAG_TOKEN] = startTagInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.END_TAG_TOKEN] = endTagInColumnGroup;\n_[IN_COLUMN_GROUP_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TABLE_BODY_MODE] = Object.create(null);\n_[IN_TABLE_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_TABLE_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_TABLE_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_TABLE_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TABLE_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TABLE_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTableBody;\n_[IN_TABLE_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTableBody;\n_[IN_TABLE_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_ROW_MODE] = Object.create(null);\n_[IN_ROW_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_ROW_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = _[IN_ROW_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\n_[IN_ROW_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_ROW_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_ROW_MODE][Tokenizer.START_TAG_TOKEN] = startTagInRow;\n_[IN_ROW_MODE][Tokenizer.END_TAG_TOKEN] = endTagInRow;\n_[IN_ROW_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_CELL_MODE] = Object.create(null);\n_[IN_CELL_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_CELL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_CELL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_CELL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_CELL_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_CELL_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCell;\n_[IN_CELL_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCell;\n_[IN_CELL_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_SELECT_MODE] = Object.create(null);\n_[IN_SELECT_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_SELECT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_SELECT_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_SELECT_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelect;\n_[IN_SELECT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelect;\n_[IN_SELECT_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_SELECT_IN_TABLE_MODE] = Object.create(null);\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelectInTable;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelectInTable;\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\n_[IN_TEMPLATE_MODE] = Object.create(null);\n_[IN_TEMPLATE_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\n_[IN_TEMPLATE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_TEMPLATE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[IN_TEMPLATE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_TEMPLATE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_TEMPLATE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTemplate;\n_[IN_TEMPLATE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTemplate;\n_[IN_TEMPLATE_MODE][Tokenizer.EOF_TOKEN] = eofInTemplate;\n_[AFTER_BODY_MODE] = Object.create(null);\n_[AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToRootHtmlElement;\n_[AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterBody;\n_[AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[IN_FRAMESET_MODE] = Object.create(null);\n_[IN_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[IN_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[IN_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[IN_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[IN_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[IN_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagInFrameset;\n_[IN_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagInFrameset;\n_[IN_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_FRAMESET_MODE] = Object.create(null);\n_[AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\n_[AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\n_[AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterFrameset;\n_[AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterFrameset;\n_[AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_AFTER_BODY_MODE] = Object.create(null);\n_[AFTER_AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = tokenAfterAfterBody;\n_[AFTER_AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\n_[AFTER_AFTER_FRAMESET_MODE] = Object.create(null);\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] = _[AFTER_AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterFrameset;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = ignoreToken;\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing; //Parser\n\nvar Parser = module.exports = function (options) {\n  this.options = mergeOptions(DEFAULT_OPTIONS, options);\n  this.treeAdapter = this.options.treeAdapter;\n  this.pendingScript = null;\n  if (this.options.locationInfo) new LocationInfoParserMixin(this);\n}; // API\n\n\nParser.prototype.parse = function (html) {\n  var document = this.treeAdapter.createDocument();\n\n  this._bootstrap(document, null);\n\n  this.tokenizer.write(html, true);\n\n  this._runParsingLoop(null);\n\n  return document;\n};\n\nParser.prototype.parseFragment = function (html, fragmentContext) {\n  //NOTE: use <template> element as a fragment context if context element was not provided,\n  //so we will parse in \"forgiving\" manner\n  if (!fragmentContext) fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []); //NOTE: create fake element which will be used as 'document' for fragment parsing.\n  //This is important for jsdom there 'document' can't be recreated, therefore\n  //fragment parsing causes messing of the main `document`.\n\n  var documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\n\n  this._bootstrap(documentMock, fragmentContext);\n\n  if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE) this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n\n  this._initTokenizerForFragmentParsing();\n\n  this._insertFakeRootElement();\n\n  this._resetInsertionMode();\n\n  this._findFormInFragmentContext();\n\n  this.tokenizer.write(html, true);\n\n  this._runParsingLoop(null);\n\n  var rootElement = this.treeAdapter.getFirstChild(documentMock),\n      fragment = this.treeAdapter.createDocumentFragment();\n\n  this._adoptNodes(rootElement, fragment);\n\n  return fragment;\n}; //Bootstrap parser\n\n\nParser.prototype._bootstrap = function (document, fragmentContext) {\n  this.tokenizer = new Tokenizer(this.options);\n  this.stopped = false;\n  this.insertionMode = INITIAL_MODE;\n  this.originalInsertionMode = '';\n  this.document = document;\n  this.fragmentContext = fragmentContext;\n  this.headElement = null;\n  this.formElement = null;\n  this.openElements = new OpenElementStack(this.document, this.treeAdapter);\n  this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\n  this.tmplInsertionModeStack = [];\n  this.tmplInsertionModeStackTop = -1;\n  this.currentTmplInsertionMode = null;\n  this.pendingCharacterTokens = [];\n  this.hasNonWhitespacePendingCharacterToken = false;\n  this.framesetOk = true;\n  this.skipNextNewLine = false;\n  this.fosterParentingEnabled = false;\n}; //Parsing loop\n\n\nParser.prototype._runParsingLoop = function (scriptHandler) {\n  while (!this.stopped) {\n    this._setupTokenizerCDATAMode();\n\n    var token = this.tokenizer.getNextToken();\n    if (token.type === Tokenizer.HIBERNATION_TOKEN) break;\n\n    if (this.skipNextNewLine) {\n      this.skipNextNewLine = false;\n\n      if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\n        if (token.chars.length === 1) continue;\n        token.chars = token.chars.substr(1);\n      }\n    }\n\n    this._processInputToken(token);\n\n    if (scriptHandler && this.pendingScript) break;\n  }\n};\n\nParser.prototype.runParsingLoopForCurrentChunk = function (writeCallback, scriptHandler) {\n  this._runParsingLoop(scriptHandler);\n\n  if (scriptHandler && this.pendingScript) {\n    var script = this.pendingScript;\n    this.pendingScript = null;\n    scriptHandler(script);\n    return;\n  }\n\n  if (writeCallback) writeCallback();\n}; //Text parsing\n\n\nParser.prototype._setupTokenizerCDATAMode = function () {\n  var current = this._getAdjustedCurrentElement();\n\n  this.tokenizer.allowCDATA = current && current !== this.document && this.treeAdapter.getNamespaceURI(current) !== NS.HTML && !this._isIntegrationPoint(current);\n};\n\nParser.prototype._switchToTextParsing = function (currentToken, nextTokenizerState) {\n  this._insertElement(currentToken, NS.HTML);\n\n  this.tokenizer.state = nextTokenizerState;\n  this.originalInsertionMode = this.insertionMode;\n  this.insertionMode = TEXT_MODE;\n};\n\nParser.prototype.switchToPlaintextParsing = function () {\n  this.insertionMode = TEXT_MODE;\n  this.originalInsertionMode = IN_BODY_MODE;\n  this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}; //Fragment parsing\n\n\nParser.prototype._getAdjustedCurrentElement = function () {\n  return this.openElements.stackTop === 0 && this.fragmentContext ? this.fragmentContext : this.openElements.current;\n};\n\nParser.prototype._findFormInFragmentContext = function () {\n  var node = this.fragmentContext;\n\n  do {\n    if (this.treeAdapter.getTagName(node) === $.FORM) {\n      this.formElement = node;\n      break;\n    }\n\n    node = this.treeAdapter.getParentNode(node);\n  } while (node);\n};\n\nParser.prototype._initTokenizerForFragmentParsing = function () {\n  if (this.treeAdapter.getNamespaceURI(this.fragmentContext) === NS.HTML) {\n    var tn = this.treeAdapter.getTagName(this.fragmentContext);\n    if (tn === $.TITLE || tn === $.TEXTAREA) this.tokenizer.state = Tokenizer.MODE.RCDATA;else if (tn === $.STYLE || tn === $.XMP || tn === $.IFRAME || tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT) this.tokenizer.state = Tokenizer.MODE.RAWTEXT;else if (tn === $.SCRIPT) this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;else if (tn === $.PLAINTEXT) this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n  }\n}; //Tree mutation\n\n\nParser.prototype._setDocumentType = function (token) {\n  this.treeAdapter.setDocumentType(this.document, token.name, token.publicId, token.systemId);\n};\n\nParser.prototype._attachElementToTree = function (element) {\n  if (this._shouldFosterParentOnInsertion()) this._fosterParentElement(element);else {\n    var parent = this.openElements.currentTmplContent || this.openElements.current;\n    this.treeAdapter.appendChild(parent, element);\n  }\n};\n\nParser.prototype._appendElement = function (token, namespaceURI) {\n  var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n  this._attachElementToTree(element);\n};\n\nParser.prototype._insertElement = function (token, namespaceURI) {\n  var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n  this._attachElementToTree(element);\n\n  this.openElements.push(element);\n};\n\nParser.prototype._insertFakeElement = function (tagName) {\n  var element = this.treeAdapter.createElement(tagName, NS.HTML, []);\n\n  this._attachElementToTree(element);\n\n  this.openElements.push(element);\n};\n\nParser.prototype._insertTemplate = function (token) {\n  var tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs),\n      content = this.treeAdapter.createDocumentFragment();\n  this.treeAdapter.setTemplateContent(tmpl, content);\n\n  this._attachElementToTree(tmpl);\n\n  this.openElements.push(tmpl);\n};\n\nParser.prototype._insertFakeRootElement = function () {\n  var element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\n  this.treeAdapter.appendChild(this.openElements.current, element);\n  this.openElements.push(element);\n};\n\nParser.prototype._appendCommentNode = function (token, parent) {\n  var commentNode = this.treeAdapter.createCommentNode(token.data);\n  this.treeAdapter.appendChild(parent, commentNode);\n};\n\nParser.prototype._insertCharacters = function (token) {\n  if (this._shouldFosterParentOnInsertion()) this._fosterParentText(token.chars);else {\n    var parent = this.openElements.currentTmplContent || this.openElements.current;\n    this.treeAdapter.insertText(parent, token.chars);\n  }\n};\n\nParser.prototype._adoptNodes = function (donor, recipient) {\n  while (true) {\n    var child = this.treeAdapter.getFirstChild(donor);\n    if (!child) break;\n    this.treeAdapter.detachNode(child);\n    this.treeAdapter.appendChild(recipient, child);\n  }\n}; //Token processing\n\n\nParser.prototype._shouldProcessTokenInForeignContent = function (token) {\n  var current = this._getAdjustedCurrentElement();\n\n  if (!current || current === this.document) return false;\n  var ns = this.treeAdapter.getNamespaceURI(current);\n  if (ns === NS.HTML) return false;\n  if (this.treeAdapter.getTagName(current) === $.ANNOTATION_XML && ns === NS.MATHML && token.type === Tokenizer.START_TAG_TOKEN && token.tagName === $.SVG) return false;\n  var isCharacterToken = token.type === Tokenizer.CHARACTER_TOKEN || token.type === Tokenizer.NULL_CHARACTER_TOKEN || token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN,\n      isMathMLTextStartTag = token.type === Tokenizer.START_TAG_TOKEN && token.tagName !== $.MGLYPH && token.tagName !== $.MALIGNMARK;\n  if ((isMathMLTextStartTag || isCharacterToken) && this._isIntegrationPoint(current, NS.MATHML)) return false;\n  if ((token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) && this._isIntegrationPoint(current, NS.HTML)) return false;\n  return token.type !== Tokenizer.EOF_TOKEN;\n};\n\nParser.prototype._processToken = function (token) {\n  _[this.insertionMode][token.type](this, token);\n};\n\nParser.prototype._processTokenInBodyMode = function (token) {\n  _[IN_BODY_MODE][token.type](this, token);\n};\n\nParser.prototype._processTokenInForeignContent = function (token) {\n  if (token.type === Tokenizer.CHARACTER_TOKEN) characterInForeignContent(this, token);else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN) nullCharacterInForeignContent(this, token);else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN) insertCharacters(this, token);else if (token.type === Tokenizer.COMMENT_TOKEN) appendComment(this, token);else if (token.type === Tokenizer.START_TAG_TOKEN) startTagInForeignContent(this, token);else if (token.type === Tokenizer.END_TAG_TOKEN) endTagInForeignContent(this, token);\n};\n\nParser.prototype._processInputToken = function (token) {\n  if (this._shouldProcessTokenInForeignContent(token)) this._processTokenInForeignContent(token);else this._processToken(token);\n}; //Integration points\n\n\nParser.prototype._isIntegrationPoint = function (element, foreignNS) {\n  var tn = this.treeAdapter.getTagName(element),\n      ns = this.treeAdapter.getNamespaceURI(element),\n      attrs = this.treeAdapter.getAttrList(element);\n  return foreignContent.isIntegrationPoint(tn, ns, attrs, foreignNS);\n}; //Active formatting elements reconstruction\n\n\nParser.prototype._reconstructActiveFormattingElements = function () {\n  var listLength = this.activeFormattingElements.length;\n\n  if (listLength) {\n    var unopenIdx = listLength,\n        entry = null;\n\n    do {\n      unopenIdx--;\n      entry = this.activeFormattingElements.entries[unopenIdx];\n\n      if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\n        unopenIdx++;\n        break;\n      }\n    } while (unopenIdx > 0);\n\n    for (var i = unopenIdx; i < listLength; i++) {\n      entry = this.activeFormattingElements.entries[i];\n\n      this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n\n      entry.element = this.openElements.current;\n    }\n  }\n}; //Close elements\n\n\nParser.prototype._closeTableCell = function () {\n  this.openElements.generateImpliedEndTags();\n  this.openElements.popUntilTableCellPopped();\n  this.activeFormattingElements.clearToLastMarker();\n  this.insertionMode = IN_ROW_MODE;\n};\n\nParser.prototype._closePElement = function () {\n  this.openElements.generateImpliedEndTagsWithExclusion($.P);\n  this.openElements.popUntilTagNamePopped($.P);\n}; //Insertion modes\n\n\nParser.prototype._resetInsertionMode = function () {\n  for (var i = this.openElements.stackTop, last = false; i >= 0; i--) {\n    var element = this.openElements.items[i];\n\n    if (i === 0) {\n      last = true;\n      if (this.fragmentContext) element = this.fragmentContext;\n    }\n\n    var tn = this.treeAdapter.getTagName(element),\n        newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\n\n    if (newInsertionMode) {\n      this.insertionMode = newInsertionMode;\n      break;\n    } else if (!last && (tn === $.TD || tn === $.TH)) {\n      this.insertionMode = IN_CELL_MODE;\n      break;\n    } else if (!last && tn === $.HEAD) {\n      this.insertionMode = IN_HEAD_MODE;\n      break;\n    } else if (tn === $.SELECT) {\n      this._resetInsertionModeForSelect(i);\n\n      break;\n    } else if (tn === $.TEMPLATE) {\n      this.insertionMode = this.currentTmplInsertionMode;\n      break;\n    } else if (tn === $.HTML) {\n      this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\n      break;\n    } else if (last) {\n      this.insertionMode = IN_BODY_MODE;\n      break;\n    }\n  }\n};\n\nParser.prototype._resetInsertionModeForSelect = function (selectIdx) {\n  if (selectIdx > 0) {\n    for (var i = selectIdx - 1; i > 0; i--) {\n      var ancestor = this.openElements.items[i],\n          tn = this.treeAdapter.getTagName(ancestor);\n      if (tn === $.TEMPLATE) break;else if (tn === $.TABLE) {\n        this.insertionMode = IN_SELECT_IN_TABLE_MODE;\n        return;\n      }\n    }\n  }\n\n  this.insertionMode = IN_SELECT_MODE;\n};\n\nParser.prototype._pushTmplInsertionMode = function (mode) {\n  this.tmplInsertionModeStack.push(mode);\n  this.tmplInsertionModeStackTop++;\n  this.currentTmplInsertionMode = mode;\n};\n\nParser.prototype._popTmplInsertionMode = function () {\n  this.tmplInsertionModeStack.pop();\n  this.tmplInsertionModeStackTop--;\n  this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\n}; //Foster parenting\n\n\nParser.prototype._isElementCausesFosterParenting = function (element) {\n  var tn = this.treeAdapter.getTagName(element);\n  return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR;\n};\n\nParser.prototype._shouldFosterParentOnInsertion = function () {\n  return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\n};\n\nParser.prototype._findFosterParentingLocation = function () {\n  var location = {\n    parent: null,\n    beforeElement: null\n  };\n\n  for (var i = this.openElements.stackTop; i >= 0; i--) {\n    var openElement = this.openElements.items[i],\n        tn = this.treeAdapter.getTagName(openElement),\n        ns = this.treeAdapter.getNamespaceURI(openElement);\n\n    if (tn === $.TEMPLATE && ns === NS.HTML) {\n      location.parent = this.treeAdapter.getTemplateContent(openElement);\n      break;\n    } else if (tn === $.TABLE) {\n      location.parent = this.treeAdapter.getParentNode(openElement);\n      if (location.parent) location.beforeElement = openElement;else location.parent = this.openElements.items[i - 1];\n      break;\n    }\n  }\n\n  if (!location.parent) location.parent = this.openElements.items[0];\n  return location;\n};\n\nParser.prototype._fosterParentElement = function (element) {\n  var location = this._findFosterParentingLocation();\n\n  if (location.beforeElement) this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);else this.treeAdapter.appendChild(location.parent, element);\n};\n\nParser.prototype._fosterParentText = function (chars) {\n  var location = this._findFosterParentingLocation();\n\n  if (location.beforeElement) this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);else this.treeAdapter.insertText(location.parent, chars);\n}; //Special elements\n\n\nParser.prototype._isSpecialElement = function (element) {\n  var tn = this.treeAdapter.getTagName(element),\n      ns = this.treeAdapter.getNamespaceURI(element);\n  return HTML.SPECIAL_ELEMENTS[ns][tn];\n}; //Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\n\n\nfunction aaObtainFormattingElementEntry(p, token) {\n  var formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n\n  if (formattingElementEntry) {\n    if (!p.openElements.contains(formattingElementEntry.element)) {\n      p.activeFormattingElements.removeEntry(formattingElementEntry);\n      formattingElementEntry = null;\n    } else if (!p.openElements.hasInScope(token.tagName)) formattingElementEntry = null;\n  } else genericEndTagInBody(p, token);\n\n  return formattingElementEntry;\n} //Steps 9 and 10 of the algorithm\n\n\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n  var furthestBlock = null;\n\n  for (var i = p.openElements.stackTop; i >= 0; i--) {\n    var element = p.openElements.items[i];\n    if (element === formattingElementEntry.element) break;\n    if (p._isSpecialElement(element)) furthestBlock = element;\n  }\n\n  if (!furthestBlock) {\n    p.openElements.popUntilElementPopped(formattingElementEntry.element);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n  }\n\n  return furthestBlock;\n} //Step 13 of the algorithm\n\n\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n  var lastElement = furthestBlock,\n      nextElement = p.openElements.getCommonAncestor(furthestBlock);\n\n  for (var i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n    //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n    nextElement = p.openElements.getCommonAncestor(element);\n    var elementEntry = p.activeFormattingElements.getElementEntry(element),\n        counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER,\n        shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n\n    if (shouldRemoveFromOpenElements) {\n      if (counterOverflow) p.activeFormattingElements.removeEntry(elementEntry);\n      p.openElements.remove(element);\n    } else {\n      element = aaRecreateElementFromEntry(p, elementEntry);\n      if (lastElement === furthestBlock) p.activeFormattingElements.bookmark = elementEntry;\n      p.treeAdapter.detachNode(lastElement);\n      p.treeAdapter.appendChild(element, lastElement);\n      lastElement = element;\n    }\n  }\n\n  return lastElement;\n} //Step 13.7 of the algorithm\n\n\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n  var ns = p.treeAdapter.getNamespaceURI(elementEntry.element),\n      newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n  p.openElements.replace(elementEntry.element, newElement);\n  elementEntry.element = newElement;\n  return newElement;\n} //Step 14 of the algorithm\n\n\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n  if (p._isElementCausesFosterParenting(commonAncestor)) p._fosterParentElement(lastElement);else {\n    var tn = p.treeAdapter.getTagName(commonAncestor),\n        ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n    if (tn === $.TEMPLATE && ns === NS.HTML) commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n    p.treeAdapter.appendChild(commonAncestor, lastElement);\n  }\n} //Steps 15-19 of the algorithm\n\n\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n  var ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element),\n      token = formattingElementEntry.token,\n      newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n\n  p._adoptNodes(furthestBlock, newElement);\n\n  p.treeAdapter.appendChild(furthestBlock, newElement);\n  p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\n  p.activeFormattingElements.removeEntry(formattingElementEntry);\n  p.openElements.remove(formattingElementEntry.element);\n  p.openElements.insertAfter(furthestBlock, newElement);\n} //Algorithm entry point\n\n\nfunction callAdoptionAgency(p, token) {\n  var formattingElementEntry;\n\n  for (var i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n    formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\n    if (!formattingElementEntry) break;\n    var furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n    if (!furthestBlock) break;\n    p.activeFormattingElements.bookmark = formattingElementEntry;\n    var lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element),\n        commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n    p.treeAdapter.detachNode(lastElement);\n    aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n    aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n  }\n} //Generic token handlers\n//------------------------------------------------------------------\n\n\nfunction ignoreToken() {//NOTE: do nothing =)\n}\n\nfunction appendComment(p, token) {\n  p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current);\n}\n\nfunction appendCommentToRootHtmlElement(p, token) {\n  p._appendCommentNode(token, p.openElements.items[0]);\n}\n\nfunction appendCommentToDocument(p, token) {\n  p._appendCommentNode(token, p.document);\n}\n\nfunction insertCharacters(p, token) {\n  p._insertCharacters(token);\n}\n\nfunction stopParsing(p) {\n  p.stopped = true;\n} //12.2.5.4.1 The \"initial\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction doctypeInInitialMode(p, token) {\n  p._setDocumentType(token);\n\n  var mode = token.forceQuirks ? HTML.DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token.name, token.publicId, token.systemId);\n  p.treeAdapter.setDocumentMode(p.document, mode);\n  p.insertionMode = BEFORE_HTML_MODE;\n}\n\nfunction tokenInInitialMode(p, token) {\n  p.treeAdapter.setDocumentMode(p.document, HTML.DOCUMENT_MODE.QUIRKS);\n  p.insertionMode = BEFORE_HTML_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.2 The \"before html\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHtml(p, token) {\n  if (token.tagName === $.HTML) {\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = BEFORE_HEAD_MODE;\n  } else tokenBeforeHtml(p, token);\n}\n\nfunction endTagBeforeHtml(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR) tokenBeforeHtml(p, token);\n}\n\nfunction tokenBeforeHtml(p, token) {\n  p._insertFakeRootElement();\n\n  p.insertionMode = BEFORE_HEAD_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.3 The \"before head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.HEAD) {\n    p._insertElement(token, NS.HTML);\n\n    p.headElement = p.openElements.current;\n    p.insertionMode = IN_HEAD_MODE;\n  } else tokenBeforeHead(p, token);\n}\n\nfunction endTagBeforeHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR) tokenBeforeHead(p, token);\n}\n\nfunction tokenBeforeHead(p, token) {\n  p._insertFakeElement($.HEAD);\n\n  p.headElement = p.openElements.current;\n  p.insertionMode = IN_HEAD_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.4 The \"in head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META) p._appendElement(token, NS.HTML);else if (tn === $.TITLE) p._switchToTextParsing(token, Tokenizer.MODE.RCDATA); //NOTE: here we assume that we always act as an interactive user agent with enabled scripting, so we parse\n  //<noscript> as a rawtext.\n  else if (tn === $.NOSCRIPT || tn === $.NOFRAMES || tn === $.STYLE) p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);else if (tn === $.SCRIPT) p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);else if (tn === $.TEMPLATE) {\n      p._insertTemplate(token, NS.HTML);\n\n      p.activeFormattingElements.insertMarker();\n      p.framesetOk = false;\n      p.insertionMode = IN_TEMPLATE_MODE;\n\n      p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\n    } else if (tn !== $.HEAD) tokenInHead(p, token);\n}\n\nfunction endTagInHead(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.HEAD) {\n    p.openElements.pop();\n    p.insertionMode = AFTER_HEAD_MODE;\n  } else if (tn === $.BODY || tn === $.BR || tn === $.HTML) tokenInHead(p, token);else if (tn === $.TEMPLATE && p.openElements.tmplCount > 0) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped($.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n\n    p._popTmplInsertionMode();\n\n    p._resetInsertionMode();\n  }\n}\n\nfunction tokenInHead(p, token) {\n  p.openElements.pop();\n  p.insertionMode = AFTER_HEAD_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.6 The \"after head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.BODY) {\n    p._insertElement(token, NS.HTML);\n\n    p.framesetOk = false;\n    p.insertionMode = IN_BODY_MODE;\n  } else if (tn === $.FRAMESET) {\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_FRAMESET_MODE;\n  } else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\n    p.openElements.push(p.headElement);\n    startTagInHead(p, token);\n    p.openElements.remove(p.headElement);\n  } else if (tn !== $.HEAD) tokenAfterHead(p, token);\n}\n\nfunction endTagAfterHead(p, token) {\n  var tn = token.tagName;\n  if (tn === $.BODY || tn === $.HTML || tn === $.BR) tokenAfterHead(p, token);else if (tn === $.TEMPLATE) endTagInHead(p, token);\n}\n\nfunction tokenAfterHead(p, token) {\n  p._insertFakeElement($.BODY);\n\n  p.insertionMode = IN_BODY_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.7 The \"in body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n}\n\nfunction characterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction htmlStartTagInBody(p, token) {\n  if (p.openElements.tmplCount === 0) p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n}\n\nfunction bodyStartTagInBody(p, token) {\n  var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (bodyElement && p.openElements.tmplCount === 0) {\n    p.framesetOk = false;\n    p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n  }\n}\n\nfunction framesetStartTagInBody(p, token) {\n  var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (p.framesetOk && bodyElement) {\n    p.treeAdapter.detachNode(bodyElement);\n    p.openElements.popAllUpToHtmlElement();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_FRAMESET_MODE;\n  }\n}\n\nfunction addressStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction numberedHeaderStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n  var tn = p.openElements.currentTagName;\n  if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) p.openElements.pop();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction preStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.framesetOk = false;\n}\n\nfunction formStartTagInBody(p, token) {\n  var inTemplate = p.openElements.tmplCount > 0;\n\n  if (!p.formElement || inTemplate) {\n    if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n    p._insertElement(token, NS.HTML);\n\n    if (!inTemplate) p.formElement = p.openElements.current;\n  }\n}\n\nfunction listItemStartTagInBody(p, token) {\n  p.framesetOk = false;\n  var tn = token.tagName;\n\n  for (var i = p.openElements.stackTop; i >= 0; i--) {\n    var element = p.openElements.items[i],\n        elementTn = p.treeAdapter.getTagName(element),\n        closeTn = null;\n    if (tn === $.LI && elementTn === $.LI) closeTn = $.LI;else if ((tn === $.DD || tn === $.DT) && (elementTn === $.DD || elementTn === $.DT)) closeTn = elementTn;\n\n    if (closeTn) {\n      p.openElements.generateImpliedEndTagsWithExclusion(closeTn);\n      p.openElements.popUntilTagNamePopped(closeTn);\n      break;\n    }\n\n    if (elementTn !== $.ADDRESS && elementTn !== $.DIV && elementTn !== $.P && p._isSpecialElement(element)) break;\n  }\n\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction plaintextStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n\n  p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\n}\n\nfunction buttonStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BUTTON)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped($.BUTTON);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction aStartTagInBody(p, token) {\n  var activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\n\n  if (activeElementEntry) {\n    callAdoptionAgency(p, token);\n    p.openElements.remove(activeElementEntry.element);\n    p.activeFormattingElements.removeEntry(activeElementEntry);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction bStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction nobrStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  if (p.openElements.hasInScope($.NOBR)) {\n    callAdoptionAgency(p, token);\n\n    p._reconstructActiveFormattingElements();\n  }\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction appletStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.activeFormattingElements.insertMarker();\n  p.framesetOk = false;\n}\n\nfunction tableStartTagInBody(p, token) {\n  if (p.treeAdapter.getDocumentMode(p.document) !== HTML.DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = IN_TABLE_MODE;\n}\n\nfunction areaStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction inputStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, NS.HTML);\n\n  var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE) p.framesetOk = false;\n}\n\nfunction paramStartTagInBody(p, token) {\n  p._appendElement(token, NS.HTML);\n}\n\nfunction hrStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n  if (p.openElements.currentTagName === $.MENUITEM) p.openElements.pop();\n\n  p._appendElement(token, NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction imageStartTagInBody(p, token) {\n  token.tagName = $.IMG;\n  areaStartTagInBody(p, token);\n}\n\nfunction textareaStartTagInBody(p, token) {\n  p._insertElement(token, NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.tokenizer.state = Tokenizer.MODE.RCDATA;\n  p.originalInsertionMode = p.insertionMode;\n  p.framesetOk = false;\n  p.insertionMode = TEXT_MODE;\n}\n\nfunction xmpStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n\n  p._reconstructActiveFormattingElements();\n\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction iframeStartTagInBody(p, token) {\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n} //NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as a rawtext.\n\n\nfunction noembedStartTagInBody(p, token) {\n  p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\n}\n\nfunction selectStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n\n  p.framesetOk = false;\n  if (p.insertionMode === IN_TABLE_MODE || p.insertionMode === IN_CAPTION_MODE || p.insertionMode === IN_TABLE_BODY_MODE || p.insertionMode === IN_ROW_MODE || p.insertionMode === IN_CELL_MODE) p.insertionMode = IN_SELECT_IN_TABLE_MODE;else p.insertionMode = IN_SELECT_MODE;\n}\n\nfunction optgroupStartTagInBody(p, token) {\n  if (p.openElements.currentTagName === $.OPTION) p.openElements.pop();\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction rbStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) p.openElements.generateImpliedEndTags();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction rtStartTagInBody(p, token) {\n  if (p.openElements.hasInScope($.RUBY)) p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction menuitemStartTagInBody(p, token) {\n  if (p.openElements.currentTagName === $.MENUITEM) p.openElements.pop(); // TODO needs clarification, see https://github.com/whatwg/html/pull/907/files#r73505877\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction menuStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope($.P)) p._closePElement();\n  if (p.openElements.currentTagName === $.MENUITEM) p.openElements.pop();\n\n  p._insertElement(token, NS.HTML);\n}\n\nfunction mathStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenMathMLAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) p._appendElement(token, NS.MATHML);else p._insertElement(token, NS.MATHML);\n}\n\nfunction svgStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenSVGAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n  if (token.selfClosing) p._appendElement(token, NS.SVG);else p._insertElement(token, NS.SVG);\n}\n\nfunction genericStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, NS.HTML);\n} //OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\n\nfunction startTagInBody(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 1:\n      if (tn === $.I || tn === $.S || tn === $.B || tn === $.U) bStartTagInBody(p, token);else if (tn === $.P) addressStartTagInBody(p, token);else if (tn === $.A) aStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 2:\n      if (tn === $.DL || tn === $.OL || tn === $.UL) addressStartTagInBody(p, token);else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) numberedHeaderStartTagInBody(p, token);else if (tn === $.LI || tn === $.DD || tn === $.DT) listItemStartTagInBody(p, token);else if (tn === $.EM || tn === $.TT) bStartTagInBody(p, token);else if (tn === $.BR) areaStartTagInBody(p, token);else if (tn === $.HR) hrStartTagInBody(p, token);else if (tn === $.RB) rbStartTagInBody(p, token);else if (tn === $.RT || tn === $.RP) rtStartTagInBody(p, token);else if (tn !== $.TH && tn !== $.TD && tn !== $.TR) genericStartTagInBody(p, token);\n      break;\n\n    case 3:\n      if (tn === $.DIV || tn === $.DIR || tn === $.NAV) addressStartTagInBody(p, token);else if (tn === $.PRE) preStartTagInBody(p, token);else if (tn === $.BIG) bStartTagInBody(p, token);else if (tn === $.IMG || tn === $.WBR) areaStartTagInBody(p, token);else if (tn === $.XMP) xmpStartTagInBody(p, token);else if (tn === $.SVG) svgStartTagInBody(p, token);else if (tn === $.RTC) rbStartTagInBody(p, token);else if (tn !== $.COL) genericStartTagInBody(p, token);\n      break;\n\n    case 4:\n      if (tn === $.HTML) htmlStartTagInBody(p, token);else if (tn === $.BASE || tn === $.LINK || tn === $.META) startTagInHead(p, token);else if (tn === $.BODY) bodyStartTagInBody(p, token);else if (tn === $.MAIN) addressStartTagInBody(p, token);else if (tn === $.FORM) formStartTagInBody(p, token);else if (tn === $.CODE || tn === $.FONT) bStartTagInBody(p, token);else if (tn === $.NOBR) nobrStartTagInBody(p, token);else if (tn === $.AREA) areaStartTagInBody(p, token);else if (tn === $.MATH) mathStartTagInBody(p, token);else if (tn === $.MENU) menuStartTagInBody(p, token);else if (tn !== $.HEAD) genericStartTagInBody(p, token);\n      break;\n\n    case 5:\n      if (tn === $.STYLE || tn === $.TITLE) startTagInHead(p, token);else if (tn === $.ASIDE) addressStartTagInBody(p, token);else if (tn === $.SMALL) bStartTagInBody(p, token);else if (tn === $.TABLE) tableStartTagInBody(p, token);else if (tn === $.EMBED) areaStartTagInBody(p, token);else if (tn === $.INPUT) inputStartTagInBody(p, token);else if (tn === $.PARAM || tn === $.TRACK) paramStartTagInBody(p, token);else if (tn === $.IMAGE) imageStartTagInBody(p, token);else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD) genericStartTagInBody(p, token);\n      break;\n\n    case 6:\n      if (tn === $.SCRIPT) startTagInHead(p, token);else if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP) addressStartTagInBody(p, token);else if (tn === $.BUTTON) buttonStartTagInBody(p, token);else if (tn === $.STRIKE || tn === $.STRONG) bStartTagInBody(p, token);else if (tn === $.APPLET || tn === $.OBJECT) appletStartTagInBody(p, token);else if (tn === $.KEYGEN) areaStartTagInBody(p, token);else if (tn === $.SOURCE) paramStartTagInBody(p, token);else if (tn === $.IFRAME) iframeStartTagInBody(p, token);else if (tn === $.SELECT) selectStartTagInBody(p, token);else if (tn === $.OPTION) optgroupStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 7:\n      if (tn === $.BGSOUND) startTagInHead(p, token);else if (tn === $.DETAILS || tn === $.ADDRESS || tn === $.ARTICLE || tn === $.SECTION || tn === $.SUMMARY) addressStartTagInBody(p, token);else if (tn === $.LISTING) preStartTagInBody(p, token);else if (tn === $.MARQUEE) appletStartTagInBody(p, token);else if (tn === $.NOEMBED) noembedStartTagInBody(p, token);else if (tn !== $.CAPTION) genericStartTagInBody(p, token);\n      break;\n\n    case 8:\n      if (tn === $.BASEFONT) startTagInHead(p, token);else if (tn === $.MENUITEM) menuitemStartTagInBody(p, token);else if (tn === $.FRAMESET) framesetStartTagInBody(p, token);else if (tn === $.FIELDSET) addressStartTagInBody(p, token);else if (tn === $.TEXTAREA) textareaStartTagInBody(p, token);else if (tn === $.TEMPLATE) startTagInHead(p, token);else if (tn === $.NOSCRIPT) noembedStartTagInBody(p, token);else if (tn === $.OPTGROUP) optgroupStartTagInBody(p, token);else if (tn !== $.COLGROUP) genericStartTagInBody(p, token);\n      break;\n\n    case 9:\n      if (tn === $.PLAINTEXT) plaintextStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) addressStartTagInBody(p, token);else genericStartTagInBody(p, token);\n      break;\n\n    default:\n      genericStartTagInBody(p, token);\n  }\n}\n\nfunction bodyEndTagInBody(p) {\n  if (p.openElements.hasInScope($.BODY)) p.insertionMode = AFTER_BODY_MODE;\n}\n\nfunction htmlEndTagInBody(p, token) {\n  if (p.openElements.hasInScope($.BODY)) {\n    p.insertionMode = AFTER_BODY_MODE;\n\n    p._processToken(token);\n  }\n}\n\nfunction addressEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction formEndTagInBody(p) {\n  var inTemplate = p.openElements.tmplCount > 0,\n      formElement = p.formElement;\n  if (!inTemplate) p.formElement = null;\n\n  if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\n    p.openElements.generateImpliedEndTags();\n    if (inTemplate) p.openElements.popUntilTagNamePopped($.FORM);else p.openElements.remove(formElement);\n  }\n}\n\nfunction pEndTagInBody(p) {\n  if (!p.openElements.hasInButtonScope($.P)) p._insertFakeElement($.P);\n\n  p._closePElement();\n}\n\nfunction liEndTagInBody(p) {\n  if (p.openElements.hasInListItemScope($.LI)) {\n    p.openElements.generateImpliedEndTagsWithExclusion($.LI);\n    p.openElements.popUntilTagNamePopped($.LI);\n  }\n}\n\nfunction ddEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(tn);\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction numberedHeaderEndTagInBody(p) {\n  if (p.openElements.hasNumberedHeaderInScope()) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilNumberedHeaderPopped();\n  }\n}\n\nfunction appletEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n    p.activeFormattingElements.clearToLastMarker();\n  }\n}\n\nfunction brEndTagInBody(p) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertFakeElement($.BR);\n\n  p.openElements.pop();\n  p.framesetOk = false;\n}\n\nfunction genericEndTagInBody(p, token) {\n  var tn = token.tagName;\n\n  for (var i = p.openElements.stackTop; i > 0; i--) {\n    var element = p.openElements.items[i];\n\n    if (p.treeAdapter.getTagName(element) === tn) {\n      p.openElements.generateImpliedEndTagsWithExclusion(tn);\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n\n    if (p._isSpecialElement(element)) break;\n  }\n} //OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\n//It's faster than using dictionary.\n\n\nfunction endTagInBody(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 1:\n      if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn === $.U) callAdoptionAgency(p, token);else if (tn === $.P) pEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 2:\n      if (tn === $.DL || tn === $.UL || tn === $.OL) addressEndTagInBody(p, token);else if (tn === $.LI) liEndTagInBody(p, token);else if (tn === $.DD || tn === $.DT) ddEndTagInBody(p, token);else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) numberedHeaderEndTagInBody(p, token);else if (tn === $.BR) brEndTagInBody(p, token);else if (tn === $.EM || tn === $.TT) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 3:\n      if (tn === $.BIG) callAdoptionAgency(p, token);else if (tn === $.DIR || tn === $.DIV || tn === $.NAV) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 4:\n      if (tn === $.BODY) bodyEndTagInBody(p, token);else if (tn === $.HTML) htmlEndTagInBody(p, token);else if (tn === $.FORM) formEndTagInBody(p, token);else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR) callAdoptionAgency(p, token);else if (tn === $.MAIN || tn === $.MENU) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 5:\n      if (tn === $.ASIDE) addressEndTagInBody(p, token);else if (tn === $.SMALL) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 6:\n      if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP) addressEndTagInBody(p, token);else if (tn === $.APPLET || tn === $.OBJECT) appletEndTagInBody(p, token);else if (tn === $.STRIKE || tn === $.STRONG) callAdoptionAgency(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 7:\n      if (tn === $.ADDRESS || tn === $.ARTICLE || tn === $.DETAILS || tn === $.SECTION || tn === $.SUMMARY) addressEndTagInBody(p, token);else if (tn === $.MARQUEE) appletEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 8:\n      if (tn === $.FIELDSET) addressEndTagInBody(p, token);else if (tn === $.TEMPLATE) endTagInHead(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    case 10:\n      if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION) addressEndTagInBody(p, token);else genericEndTagInBody(p, token);\n      break;\n\n    default:\n      genericEndTagInBody(p, token);\n  }\n}\n\nfunction eofInBody(p, token) {\n  if (p.tmplInsertionModeStackTop > -1) eofInTemplate(p, token);else p.stopped = true;\n} //12.2.5.4.8 The \"text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction endTagInText(p, token) {\n  if (token.tagName === $.SCRIPT) p.pendingScript = p.openElements.current;\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n}\n\nfunction eofInText(p, token) {\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} //12.2.5.4.9 The \"in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction characterInTable(p, token) {\n  var curTn = p.openElements.currentTagName;\n\n  if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\n    p.pendingCharacterTokens = [];\n    p.hasNonWhitespacePendingCharacterToken = false;\n    p.originalInsertionMode = p.insertionMode;\n    p.insertionMode = IN_TABLE_TEXT_MODE;\n\n    p._processToken(token);\n  } else tokenInTable(p, token);\n}\n\nfunction captionStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p.activeFormattingElements.insertMarker();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_CAPTION_MODE;\n}\n\nfunction colgroupStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_COLUMN_GROUP_MODE;\n}\n\nfunction colStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement($.COLGROUP);\n\n  p.insertionMode = IN_COLUMN_GROUP_MODE;\n\n  p._processToken(token);\n}\n\nfunction tbodyStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, NS.HTML);\n\n  p.insertionMode = IN_TABLE_BODY_MODE;\n}\n\nfunction tdStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement($.TBODY);\n\n  p.insertionMode = IN_TABLE_BODY_MODE;\n\n  p._processToken(token);\n}\n\nfunction tableStartTagInTable(p, token) {\n  if (p.openElements.hasInTableScope($.TABLE)) {\n    p.openElements.popUntilTagNamePopped($.TABLE);\n\n    p._resetInsertionMode();\n\n    p._processToken(token);\n  }\n}\n\nfunction inputStartTagInTable(p, token) {\n  var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\n  if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE) p._appendElement(token, NS.HTML);else tokenInTable(p, token);\n}\n\nfunction formStartTagInTable(p, token) {\n  if (!p.formElement && p.openElements.tmplCount === 0) {\n    p._insertElement(token, NS.HTML);\n\n    p.formElement = p.openElements.current;\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInTable(p, token) {\n  var tn = token.tagName;\n\n  switch (tn.length) {\n    case 2:\n      if (tn === $.TD || tn === $.TH || tn === $.TR) tdStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 3:\n      if (tn === $.COL) colStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 4:\n      if (tn === $.FORM) formStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 5:\n      if (tn === $.TABLE) tableStartTagInTable(p, token);else if (tn === $.STYLE) startTagInHead(p, token);else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) tbodyStartTagInTable(p, token);else if (tn === $.INPUT) inputStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 6:\n      if (tn === $.SCRIPT) startTagInHead(p, token);else tokenInTable(p, token);\n      break;\n\n    case 7:\n      if (tn === $.CAPTION) captionStartTagInTable(p, token);else tokenInTable(p, token);\n      break;\n\n    case 8:\n      if (tn === $.COLGROUP) colgroupStartTagInTable(p, token);else if (tn === $.TEMPLATE) startTagInHead(p, token);else tokenInTable(p, token);\n      break;\n\n    default:\n      tokenInTable(p, token);\n  }\n}\n\nfunction endTagInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.TABLE)) {\n      p.openElements.popUntilTagNamePopped($.TABLE);\n\n      p._resetInsertionMode();\n    }\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) tokenInTable(p, token);\n}\n\nfunction tokenInTable(p, token) {\n  var savedFosterParentingState = p.fosterParentingEnabled;\n  p.fosterParentingEnabled = true;\n\n  p._processTokenInBodyMode(token);\n\n  p.fosterParentingEnabled = savedFosterParentingState;\n} //12.2.5.4.10 The \"in table text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n}\n\nfunction characterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n  p.hasNonWhitespacePendingCharacterToken = true;\n}\n\nfunction tokenInTableText(p, token) {\n  var i = 0;\n\n  if (p.hasNonWhitespacePendingCharacterToken) {\n    for (; i < p.pendingCharacterTokens.length; i++) tokenInTable(p, p.pendingCharacterTokens[i]);\n  } else {\n    for (; i < p.pendingCharacterTokens.length; i++) p._insertCharacters(p.pendingCharacterTokens[i]);\n  }\n\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} //12.2.5.4.11 The \"in caption\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCaption(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_TABLE_MODE;\n\n      p._processToken(token);\n    }\n  } else startTagInBody(p, token);\n}\n\nfunction endTagInCaption(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped($.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_TABLE_MODE;\n      if (tn === $.TABLE) p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR) endTagInBody(p, token);\n} //12.2.5.4.12 The \"in column group\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInColumnGroup(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.COL) p._appendElement(token, NS.HTML);else if (tn === $.TEMPLATE) startTagInHead(p, token);else tokenInColumnGroup(p, token);\n}\n\nfunction endTagInColumnGroup(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.COLGROUP) {\n    if (p.openElements.currentTagName === $.COLGROUP) {\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);else if (tn !== $.COL) tokenInColumnGroup(p, token);\n}\n\nfunction tokenInColumnGroup(p, token) {\n  if (p.openElements.currentTagName === $.COLGROUP) {\n    p.openElements.pop();\n    p.insertionMode = IN_TABLE_MODE;\n\n    p._processToken(token);\n  }\n} //12.2.5.4.13 The \"in table body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTableBody(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TR) {\n    p.openElements.clearBackToTableBodyContext();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_ROW_MODE;\n  } else if (tn === $.TH || tn === $.TD) {\n    p.openElements.clearBackToTableBodyContext();\n\n    p._insertFakeElement($.TR);\n\n    p.insertionMode = IN_ROW_MODE;\n\n    p._processToken(token);\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n\n      p._processToken(token);\n    }\n  } else startTagInTable(p, token);\n}\n\nfunction endTagInTableBody(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n    }\n  } else if (tn === $.TABLE) {\n    if (p.openElements.hasTableBodyContextInTableScope()) {\n      p.openElements.clearBackToTableBodyContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_MODE;\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR) endTagInTable(p, token);\n} //12.2.5.4.14 The \"in row\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInRow(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TH || tn === $.TD) {\n    p.openElements.clearBackToTableRowContext();\n\n    p._insertElement(token, NS.HTML);\n\n    p.insertionMode = IN_CELL_MODE;\n    p.activeFormattingElements.insertMarker();\n  } else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n\n      p._processToken(token);\n    }\n  } else startTagInTable(p, token);\n}\n\nfunction endTagInRow(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n    }\n  } else if (tn === $.TABLE) {\n    if (p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n\n      p._processToken(token);\n    }\n  } else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\n    if (p.openElements.hasInTableScope(tn) || p.openElements.hasInTableScope($.TR)) {\n      p.openElements.clearBackToTableRowContext();\n      p.openElements.pop();\n      p.insertionMode = IN_TABLE_BODY_MODE;\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP || tn !== $.HTML && tn !== $.TD && tn !== $.TH) endTagInTable(p, token);\n} //12.2.5.4.15 The \"in cell\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCell(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY || tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\n      p._closeTableCell();\n\n      p._processToken(token);\n    }\n  } else startTagInBody(p, token);\n}\n\nfunction endTagInCell(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped(tn);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = IN_ROW_MODE;\n    }\n  } else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p._closeTableCell();\n\n      p._processToken(token);\n    }\n  } else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML) endTagInBody(p, token);\n} //12.2.5.4.16 The \"in select\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelect(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) p.openElements.pop();\n\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.OPTGROUP) {\n    if (p.openElements.currentTagName === $.OPTION) p.openElements.pop();\n    if (p.openElements.currentTagName === $.OPTGROUP) p.openElements.pop();\n\n    p._insertElement(token, NS.HTML);\n  } else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA || tn === $.SELECT) {\n    if (p.openElements.hasInSelectScope($.SELECT)) {\n      p.openElements.popUntilTagNamePopped($.SELECT);\n\n      p._resetInsertionMode();\n\n      if (tn !== $.SELECT) p._processToken(token);\n    }\n  } else if (tn === $.SCRIPT || tn === $.TEMPLATE) startTagInHead(p, token);\n}\n\nfunction endTagInSelect(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.OPTGROUP) {\n    var prevOpenElement = p.openElements.items[p.openElements.stackTop - 1],\n        prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\n    if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP) p.openElements.pop();\n    if (p.openElements.currentTagName === $.OPTGROUP) p.openElements.pop();\n  } else if (tn === $.OPTION) {\n    if (p.openElements.currentTagName === $.OPTION) p.openElements.pop();\n  } else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n\n    p._resetInsertionMode();\n  } else if (tn === $.TEMPLATE) endTagInHead(p, token);\n} //12.2.5.4.17 The \"in select in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelectInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    p.openElements.popUntilTagNamePopped($.SELECT);\n\n    p._resetInsertionMode();\n\n    p._processToken(token);\n  } else startTagInSelect(p, token);\n}\n\nfunction endTagInSelectInTable(p, token) {\n  var tn = token.tagName;\n\n  if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.popUntilTagNamePopped($.SELECT);\n\n      p._resetInsertionMode();\n\n      p._processToken(token);\n    }\n  } else endTagInSelect(p, token);\n} //12.2.5.4.18 The \"in template\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTemplate(p, token) {\n  var tn = token.tagName;\n  if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META || tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) startTagInHead(p, token);else {\n    var newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\n\n    p._popTmplInsertionMode();\n\n    p._pushTmplInsertionMode(newInsertionMode);\n\n    p.insertionMode = newInsertionMode;\n\n    p._processToken(token);\n  }\n}\n\nfunction endTagInTemplate(p, token) {\n  if (token.tagName === $.TEMPLATE) endTagInHead(p, token);\n}\n\nfunction eofInTemplate(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.popUntilTagNamePopped($.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n\n    p._popTmplInsertionMode();\n\n    p._resetInsertionMode();\n\n    p._processToken(token);\n  } else p.stopped = true;\n} //12.2.5.4.19 The \"after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) startTagInBody(p, token);else tokenAfterBody(p, token);\n}\n\nfunction endTagAfterBody(p, token) {\n  if (token.tagName === $.HTML) {\n    if (!p.fragmentContext) p.insertionMode = AFTER_AFTER_BODY_MODE;\n  } else tokenAfterBody(p, token);\n}\n\nfunction tokenAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.20 The \"in frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.FRAMESET) p._insertElement(token, NS.HTML);else if (tn === $.FRAME) p._appendElement(token, NS.HTML);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n}\n\nfunction endTagInFrameset(p, token) {\n  if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n    p.openElements.pop();\n    if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET) p.insertionMode = AFTER_FRAMESET_MODE;\n  }\n} //12.2.5.4.21 The \"after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n}\n\nfunction endTagAfterFrameset(p, token) {\n  if (token.tagName === $.HTML) p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\n} //12.2.5.4.22 The \"after after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterBody(p, token) {\n  if (token.tagName === $.HTML) startTagInBody(p, token);else tokenAfterAfterBody(p, token);\n}\n\nfunction tokenAfterAfterBody(p, token) {\n  p.insertionMode = IN_BODY_MODE;\n\n  p._processToken(token);\n} //12.2.5.4.23 The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterFrameset(p, token) {\n  var tn = token.tagName;\n  if (tn === $.HTML) startTagInBody(p, token);else if (tn === $.NOFRAMES) startTagInHead(p, token);\n} //12.2.5.5 The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\n\n\nfunction nullCharacterInForeignContent(p, token) {\n  token.chars = UNICODE.REPLACEMENT_CHARACTER;\n\n  p._insertCharacters(token);\n}\n\nfunction characterInForeignContent(p, token) {\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction startTagInForeignContent(p, token) {\n  if (foreignContent.causesExit(token) && !p.fragmentContext) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML && !p._isIntegrationPoint(p.openElements.current)) p.openElements.pop();\n\n    p._processToken(token);\n  } else {\n    var current = p._getAdjustedCurrentElement(),\n        currentNs = p.treeAdapter.getNamespaceURI(current);\n\n    if (currentNs === NS.MATHML) foreignContent.adjustTokenMathMLAttrs(token);else if (currentNs === NS.SVG) {\n      foreignContent.adjustTokenSVGTagName(token);\n      foreignContent.adjustTokenSVGAttrs(token);\n    }\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) p._appendElement(token, currentNs);else p._insertElement(token, currentNs);\n  }\n}\n\nfunction endTagInForeignContent(p, token) {\n  for (var i = p.openElements.stackTop; i > 0; i--) {\n    var element = p.openElements.items[i];\n\n    if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\n      p._processToken(token);\n\n      break;\n    }\n\n    if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\n      p.openElements.popUntilElementPopped(element);\n      break;\n    }\n  }\n}","map":{"version":3,"sources":["D:/medx_panel/node_modules/react-render-html/node_modules/parse5/lib/parser/index.js"],"names":["Tokenizer","require","OpenElementStack","FormattingElementList","LocationInfoParserMixin","defaultTreeAdapter","mergeOptions","doctype","foreignContent","UNICODE","HTML","$","TAG_NAMES","NS","NAMESPACES","ATTRS","DEFAULT_OPTIONS","locationInfo","treeAdapter","HIDDEN_INPUT_TYPE","AA_OUTER_LOOP_ITER","AA_INNER_LOOP_ITER","INITIAL_MODE","BEFORE_HTML_MODE","BEFORE_HEAD_MODE","IN_HEAD_MODE","AFTER_HEAD_MODE","IN_BODY_MODE","TEXT_MODE","IN_TABLE_MODE","IN_TABLE_TEXT_MODE","IN_CAPTION_MODE","IN_COLUMN_GROUP_MODE","IN_TABLE_BODY_MODE","IN_ROW_MODE","IN_CELL_MODE","IN_SELECT_MODE","IN_SELECT_IN_TABLE_MODE","IN_TEMPLATE_MODE","AFTER_BODY_MODE","IN_FRAMESET_MODE","AFTER_FRAMESET_MODE","AFTER_AFTER_BODY_MODE","AFTER_AFTER_FRAMESET_MODE","INSERTION_MODE_RESET_MAP","Object","create","TR","TBODY","THEAD","TFOOT","CAPTION","COLGROUP","TABLE","BODY","FRAMESET","TEMPLATE_INSERTION_MODE_SWITCH_MAP","COL","TD","TH","_","CHARACTER_TOKEN","NULL_CHARACTER_TOKEN","tokenInInitialMode","WHITESPACE_CHARACTER_TOKEN","ignoreToken","COMMENT_TOKEN","appendComment","DOCTYPE_TOKEN","doctypeInInitialMode","START_TAG_TOKEN","END_TAG_TOKEN","EOF_TOKEN","tokenBeforeHtml","startTagBeforeHtml","endTagBeforeHtml","tokenBeforeHead","startTagBeforeHead","endTagBeforeHead","tokenInHead","insertCharacters","startTagInHead","endTagInHead","tokenAfterHead","startTagAfterHead","endTagAfterHead","characterInBody","whitespaceCharacterInBody","startTagInBody","endTagInBody","eofInBody","endTagInText","eofInText","characterInTable","startTagInTable","endTagInTable","characterInTableText","whitespaceCharacterInTableText","tokenInTableText","startTagInCaption","endTagInCaption","tokenInColumnGroup","startTagInColumnGroup","endTagInColumnGroup","startTagInTableBody","endTagInTableBody","startTagInRow","endTagInRow","startTagInCell","endTagInCell","startTagInSelect","endTagInSelect","startTagInSelectInTable","endTagInSelectInTable","startTagInTemplate","endTagInTemplate","eofInTemplate","tokenAfterBody","appendCommentToRootHtmlElement","startTagAfterBody","endTagAfterBody","stopParsing","startTagInFrameset","endTagInFrameset","startTagAfterFrameset","endTagAfterFrameset","tokenAfterAfterBody","appendCommentToDocument","startTagAfterAfterBody","startTagAfterAfterFrameset","Parser","module","exports","options","pendingScript","prototype","parse","html","document","createDocument","_bootstrap","tokenizer","write","_runParsingLoop","parseFragment","fragmentContext","createElement","TEMPLATE","documentMock","getTagName","_pushTmplInsertionMode","_initTokenizerForFragmentParsing","_insertFakeRootElement","_resetInsertionMode","_findFormInFragmentContext","rootElement","getFirstChild","fragment","createDocumentFragment","_adoptNodes","stopped","insertionMode","originalInsertionMode","headElement","formElement","openElements","activeFormattingElements","tmplInsertionModeStack","tmplInsertionModeStackTop","currentTmplInsertionMode","pendingCharacterTokens","hasNonWhitespacePendingCharacterToken","framesetOk","skipNextNewLine","fosterParentingEnabled","scriptHandler","_setupTokenizerCDATAMode","token","getNextToken","type","HIBERNATION_TOKEN","chars","length","substr","_processInputToken","runParsingLoopForCurrentChunk","writeCallback","script","current","_getAdjustedCurrentElement","allowCDATA","getNamespaceURI","_isIntegrationPoint","_switchToTextParsing","currentToken","nextTokenizerState","_insertElement","state","switchToPlaintextParsing","MODE","PLAINTEXT","stackTop","node","FORM","getParentNode","tn","TITLE","TEXTAREA","RCDATA","STYLE","XMP","IFRAME","NOEMBED","NOFRAMES","NOSCRIPT","RAWTEXT","SCRIPT","SCRIPT_DATA","_setDocumentType","setDocumentType","name","publicId","systemId","_attachElementToTree","element","_shouldFosterParentOnInsertion","_fosterParentElement","parent","currentTmplContent","appendChild","_appendElement","namespaceURI","tagName","attrs","push","_insertFakeElement","_insertTemplate","tmpl","content","setTemplateContent","_appendCommentNode","commentNode","createCommentNode","data","_insertCharacters","_fosterParentText","insertText","donor","recipient","child","detachNode","_shouldProcessTokenInForeignContent","ns","ANNOTATION_XML","MATHML","SVG","isCharacterToken","isMathMLTextStartTag","MGLYPH","MALIGNMARK","_processToken","_processTokenInBodyMode","_processTokenInForeignContent","characterInForeignContent","nullCharacterInForeignContent","startTagInForeignContent","endTagInForeignContent","foreignNS","getAttrList","isIntegrationPoint","_reconstructActiveFormattingElements","listLength","unopenIdx","entry","entries","MARKER_ENTRY","contains","i","_closeTableCell","generateImpliedEndTags","popUntilTableCellPopped","clearToLastMarker","_closePElement","generateImpliedEndTagsWithExclusion","P","popUntilTagNamePopped","last","items","newInsertionMode","HEAD","SELECT","_resetInsertionModeForSelect","selectIdx","ancestor","mode","_popTmplInsertionMode","pop","_isElementCausesFosterParenting","_findFosterParentingLocation","location","beforeElement","openElement","getTemplateContent","insertBefore","insertTextBefore","_isSpecialElement","SPECIAL_ELEMENTS","aaObtainFormattingElementEntry","p","formattingElementEntry","getElementEntryInScopeWithTagName","removeEntry","hasInScope","genericEndTagInBody","aaObtainFurthestBlock","furthestBlock","popUntilElementPopped","aaInnerLoop","formattingElement","lastElement","nextElement","getCommonAncestor","elementEntry","getElementEntry","counterOverflow","shouldRemoveFromOpenElements","remove","aaRecreateElementFromEntry","bookmark","newElement","replace","aaInsertLastNodeInCommonAncestor","commonAncestor","aaReplaceFormattingElement","insertElementAfterBookmark","insertAfter","callAdoptionAgency","forceQuirks","DOCUMENT_MODE","QUIRKS","getDocumentMode","setDocumentMode","BR","BASE","BASEFONT","BGSOUND","LINK","META","insertMarker","tmplCount","htmlStartTagInBody","adoptAttributes","bodyStartTagInBody","bodyElement","tryPeekProperlyNestedBodyElement","framesetStartTagInBody","popAllUpToHtmlElement","addressStartTagInBody","hasInButtonScope","numberedHeaderStartTagInBody","currentTagName","H1","H2","H3","H4","H5","H6","preStartTagInBody","formStartTagInBody","inTemplate","listItemStartTagInBody","elementTn","closeTn","LI","DD","DT","ADDRESS","DIV","plaintextStartTagInBody","buttonStartTagInBody","BUTTON","aStartTagInBody","activeElementEntry","A","pushElement","bStartTagInBody","nobrStartTagInBody","NOBR","appletStartTagInBody","tableStartTagInBody","areaStartTagInBody","inputStartTagInBody","inputType","getTokenAttr","TYPE","toLowerCase","paramStartTagInBody","hrStartTagInBody","MENUITEM","imageStartTagInBody","IMG","textareaStartTagInBody","xmpStartTagInBody","iframeStartTagInBody","noembedStartTagInBody","selectStartTagInBody","optgroupStartTagInBody","OPTION","rbStartTagInBody","RUBY","rtStartTagInBody","RTC","menuitemStartTagInBody","menuStartTagInBody","mathStartTagInBody","adjustTokenMathMLAttrs","adjustTokenXMLAttrs","selfClosing","svgStartTagInBody","adjustTokenSVGAttrs","genericStartTagInBody","I","S","B","U","DL","OL","UL","EM","TT","HR","RB","RT","RP","DIR","NAV","PRE","BIG","WBR","MAIN","CODE","FONT","AREA","MATH","MENU","ASIDE","SMALL","EMBED","INPUT","PARAM","TRACK","IMAGE","FRAME","CENTER","FIGURE","FOOTER","HEADER","HGROUP","STRIKE","STRONG","APPLET","OBJECT","KEYGEN","SOURCE","DETAILS","ARTICLE","SECTION","SUMMARY","LISTING","MARQUEE","FIELDSET","OPTGROUP","BLOCKQUOTE","FIGCAPTION","bodyEndTagInBody","htmlEndTagInBody","addressEndTagInBody","formEndTagInBody","pEndTagInBody","liEndTagInBody","hasInListItemScope","ddEndTagInBody","numberedHeaderEndTagInBody","hasNumberedHeaderInScope","popUntilNumberedHeaderPopped","appletEndTagInBody","brEndTagInBody","curTn","tokenInTable","captionStartTagInTable","clearBackToTableContext","colgroupStartTagInTable","colStartTagInTable","tbodyStartTagInTable","tdStartTagInTable","tableStartTagInTable","hasInTableScope","inputStartTagInTable","formStartTagInTable","savedFosterParentingState","clearBackToTableBodyContext","hasTableBodyContextInTableScope","clearBackToTableRowContext","hasInSelectScope","prevOpenElement","prevOpenElementTn","isRootHtmlElementCurrent","REPLACEMENT_CHARACTER","causesExit","currentNs","adjustTokenSVGTagName"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nvar Tokenizer = require('../tokenizer'),\r\n    OpenElementStack = require('./open_element_stack'),\r\n    FormattingElementList = require('./formatting_element_list'),\r\n    LocationInfoParserMixin = require('../extensions/location_info/parser_mixin'),\r\n    defaultTreeAdapter = require('../tree_adapters/default'),\r\n    mergeOptions = require('../utils/merge_options'),\r\n    doctype = require('../common/doctype'),\r\n    foreignContent = require('../common/foreign_content'),\r\n    UNICODE = require('../common/unicode'),\r\n    HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES,\r\n    ATTRS = HTML.ATTRS;\r\n\r\nvar DEFAULT_OPTIONS = {\r\n    locationInfo: false,\r\n    treeAdapter: defaultTreeAdapter\r\n};\r\n\r\n//Misc constants\r\nvar HIDDEN_INPUT_TYPE = 'hidden';\r\n\r\n//Adoption agency loops iteration count\r\nvar AA_OUTER_LOOP_ITER = 8,\r\n    AA_INNER_LOOP_ITER = 3;\r\n\r\n//Insertion modes\r\nvar INITIAL_MODE = 'INITIAL_MODE',\r\n    BEFORE_HTML_MODE = 'BEFORE_HTML_MODE',\r\n    BEFORE_HEAD_MODE = 'BEFORE_HEAD_MODE',\r\n    IN_HEAD_MODE = 'IN_HEAD_MODE',\r\n    AFTER_HEAD_MODE = 'AFTER_HEAD_MODE',\r\n    IN_BODY_MODE = 'IN_BODY_MODE',\r\n    TEXT_MODE = 'TEXT_MODE',\r\n    IN_TABLE_MODE = 'IN_TABLE_MODE',\r\n    IN_TABLE_TEXT_MODE = 'IN_TABLE_TEXT_MODE',\r\n    IN_CAPTION_MODE = 'IN_CAPTION_MODE',\r\n    IN_COLUMN_GROUP_MODE = 'IN_COLUMN_GROUP_MODE',\r\n    IN_TABLE_BODY_MODE = 'IN_TABLE_BODY_MODE',\r\n    IN_ROW_MODE = 'IN_ROW_MODE',\r\n    IN_CELL_MODE = 'IN_CELL_MODE',\r\n    IN_SELECT_MODE = 'IN_SELECT_MODE',\r\n    IN_SELECT_IN_TABLE_MODE = 'IN_SELECT_IN_TABLE_MODE',\r\n    IN_TEMPLATE_MODE = 'IN_TEMPLATE_MODE',\r\n    AFTER_BODY_MODE = 'AFTER_BODY_MODE',\r\n    IN_FRAMESET_MODE = 'IN_FRAMESET_MODE',\r\n    AFTER_FRAMESET_MODE = 'AFTER_FRAMESET_MODE',\r\n    AFTER_AFTER_BODY_MODE = 'AFTER_AFTER_BODY_MODE',\r\n    AFTER_AFTER_FRAMESET_MODE = 'AFTER_AFTER_FRAMESET_MODE';\r\n\r\n//Insertion mode reset map\r\nvar INSERTION_MODE_RESET_MAP = Object.create(null);\r\n\r\nINSERTION_MODE_RESET_MAP[$.TR] = IN_ROW_MODE;\r\nINSERTION_MODE_RESET_MAP[$.TBODY] =\r\nINSERTION_MODE_RESET_MAP[$.THEAD] =\r\nINSERTION_MODE_RESET_MAP[$.TFOOT] = IN_TABLE_BODY_MODE;\r\nINSERTION_MODE_RESET_MAP[$.CAPTION] = IN_CAPTION_MODE;\r\nINSERTION_MODE_RESET_MAP[$.COLGROUP] = IN_COLUMN_GROUP_MODE;\r\nINSERTION_MODE_RESET_MAP[$.TABLE] = IN_TABLE_MODE;\r\nINSERTION_MODE_RESET_MAP[$.BODY] = IN_BODY_MODE;\r\nINSERTION_MODE_RESET_MAP[$.FRAMESET] = IN_FRAMESET_MODE;\r\n\r\n//Template insertion mode switch map\r\nvar TEMPLATE_INSERTION_MODE_SWITCH_MAP = Object.create(null);\r\n\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.CAPTION] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COLGROUP] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TBODY] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TFOOT] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.THEAD] = IN_TABLE_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.COL] = IN_COLUMN_GROUP_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TR] = IN_TABLE_BODY_MODE;\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TD] =\r\nTEMPLATE_INSERTION_MODE_SWITCH_MAP[$.TH] = IN_ROW_MODE;\r\n\r\n//Token handlers map for insertion modes\r\nvar _ = Object.create(null);\r\n\r\n_[INITIAL_MODE] = Object.create(null);\r\n_[INITIAL_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInInitialMode;\r\n_[INITIAL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[INITIAL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[INITIAL_MODE][Tokenizer.DOCTYPE_TOKEN] = doctypeInInitialMode;\r\n_[INITIAL_MODE][Tokenizer.START_TAG_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.END_TAG_TOKEN] =\r\n_[INITIAL_MODE][Tokenizer.EOF_TOKEN] = tokenInInitialMode;\r\n\r\n_[BEFORE_HTML_MODE] = Object.create(null);\r\n_[BEFORE_HTML_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[BEFORE_HTML_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[BEFORE_HTML_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[BEFORE_HTML_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[BEFORE_HTML_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHtml;\r\n_[BEFORE_HTML_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHtml;\r\n\r\n_[BEFORE_HEAD_MODE] = Object.create(null);\r\n_[BEFORE_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[BEFORE_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = ignoreToken;\r\n_[BEFORE_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[BEFORE_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[BEFORE_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagBeforeHead;\r\n_[BEFORE_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenBeforeHead;\r\n\r\n_[IN_HEAD_MODE] = Object.create(null);\r\n_[IN_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInHead;\r\n_[IN_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagInHead;\r\n_[IN_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagInHead;\r\n_[IN_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenInHead;\r\n\r\n_[AFTER_HEAD_MODE] = Object.create(null);\r\n_[AFTER_HEAD_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_HEAD_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[AFTER_HEAD_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[AFTER_HEAD_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_HEAD_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterHead;\r\n_[AFTER_HEAD_MODE][Tokenizer.EOF_TOKEN] = tokenAfterHead;\r\n\r\n_[IN_BODY_MODE] = Object.create(null);\r\n_[IN_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInBody;\r\n_[IN_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInBody;\r\n_[IN_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[TEXT_MODE] = Object.create(null);\r\n_[TEXT_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[TEXT_MODE][Tokenizer.COMMENT_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] =\r\n_[TEXT_MODE][Tokenizer.START_TAG_TOKEN] = ignoreToken;\r\n_[TEXT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInText;\r\n_[TEXT_MODE][Tokenizer.EOF_TOKEN] = eofInText;\r\n\r\n_[IN_TABLE_MODE] = Object.create(null);\r\n_[IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTable;\r\n_[IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTable;\r\n_[IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TABLE_TEXT_MODE] = Object.create(null);\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.CHARACTER_TOKEN] = characterInTableText;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInTableText;\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.COMMENT_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.DOCTYPE_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.START_TAG_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.END_TAG_TOKEN] =\r\n_[IN_TABLE_TEXT_MODE][Tokenizer.EOF_TOKEN] = tokenInTableText;\r\n\r\n_[IN_CAPTION_MODE] = Object.create(null);\r\n_[IN_CAPTION_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_CAPTION_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_CAPTION_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_CAPTION_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_CAPTION_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_CAPTION_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCaption;\r\n_[IN_CAPTION_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCaption;\r\n_[IN_CAPTION_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_COLUMN_GROUP_MODE] = Object.create(null);\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.START_TAG_TOKEN] = startTagInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.END_TAG_TOKEN] = endTagInColumnGroup;\r\n_[IN_COLUMN_GROUP_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TABLE_BODY_MODE] = Object.create(null);\r\n_[IN_TABLE_BODY_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_TABLE_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_TABLE_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTableBody;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTableBody;\r\n_[IN_TABLE_BODY_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_ROW_MODE] = Object.create(null);\r\n_[IN_ROW_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_ROW_MODE][Tokenizer.NULL_CHARACTER_TOKEN] =\r\n_[IN_ROW_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = characterInTable;\r\n_[IN_ROW_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_ROW_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_ROW_MODE][Tokenizer.START_TAG_TOKEN] = startTagInRow;\r\n_[IN_ROW_MODE][Tokenizer.END_TAG_TOKEN] = endTagInRow;\r\n_[IN_ROW_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_CELL_MODE] = Object.create(null);\r\n_[IN_CELL_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_CELL_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_CELL_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_CELL_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_CELL_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_CELL_MODE][Tokenizer.START_TAG_TOKEN] = startTagInCell;\r\n_[IN_CELL_MODE][Tokenizer.END_TAG_TOKEN] = endTagInCell;\r\n_[IN_CELL_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_SELECT_MODE] = Object.create(null);\r\n_[IN_SELECT_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_SELECT_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_SELECT_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_SELECT_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelect;\r\n_[IN_SELECT_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelect;\r\n_[IN_SELECT_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_SELECT_IN_TABLE_MODE] = Object.create(null);\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInSelectInTable;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInSelectInTable;\r\n_[IN_SELECT_IN_TABLE_MODE][Tokenizer.EOF_TOKEN] = eofInBody;\r\n\r\n_[IN_TEMPLATE_MODE] = Object.create(null);\r\n_[IN_TEMPLATE_MODE][Tokenizer.CHARACTER_TOKEN] = characterInBody;\r\n_[IN_TEMPLATE_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_TEMPLATE_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[IN_TEMPLATE_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_TEMPLATE_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_TEMPLATE_MODE][Tokenizer.START_TAG_TOKEN] = startTagInTemplate;\r\n_[IN_TEMPLATE_MODE][Tokenizer.END_TAG_TOKEN] = endTagInTemplate;\r\n_[IN_TEMPLATE_MODE][Tokenizer.EOF_TOKEN] = eofInTemplate;\r\n\r\n_[AFTER_BODY_MODE] = Object.create(null);\r\n_[AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToRootHtmlElement;\r\n_[AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterBody;\r\n_[AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[IN_FRAMESET_MODE] = Object.create(null);\r\n_[IN_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[IN_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[IN_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[IN_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[IN_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[IN_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagInFrameset;\r\n_[IN_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagInFrameset;\r\n_[IN_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_FRAMESET_MODE] = Object.create(null);\r\n_[AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = insertCharacters;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendComment;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterFrameset;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = endTagAfterFrameset;\r\n_[AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_AFTER_BODY_MODE] = Object.create(null);\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.CHARACTER_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.END_TAG_TOKEN] = tokenAfterAfterBody;\r\n_[AFTER_AFTER_BODY_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n_[AFTER_AFTER_FRAMESET_MODE] = Object.create(null);\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.CHARACTER_TOKEN] =\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.NULL_CHARACTER_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.WHITESPACE_CHARACTER_TOKEN] = whitespaceCharacterInBody;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.COMMENT_TOKEN] = appendCommentToDocument;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.DOCTYPE_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.START_TAG_TOKEN] = startTagAfterAfterFrameset;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.END_TAG_TOKEN] = ignoreToken;\r\n_[AFTER_AFTER_FRAMESET_MODE][Tokenizer.EOF_TOKEN] = stopParsing;\r\n\r\n\r\n//Parser\r\nvar Parser = module.exports = function (options) {\r\n    this.options = mergeOptions(DEFAULT_OPTIONS, options);\r\n\r\n    this.treeAdapter = this.options.treeAdapter;\r\n    this.pendingScript = null;\r\n\r\n    if (this.options.locationInfo)\r\n        new LocationInfoParserMixin(this);\r\n};\r\n\r\n// API\r\nParser.prototype.parse = function (html) {\r\n    var document = this.treeAdapter.createDocument();\r\n\r\n    this._bootstrap(document, null);\r\n    this.tokenizer.write(html, true);\r\n    this._runParsingLoop(null);\r\n\r\n    return document;\r\n};\r\n\r\nParser.prototype.parseFragment = function (html, fragmentContext) {\r\n    //NOTE: use <template> element as a fragment context if context element was not provided,\r\n    //so we will parse in \"forgiving\" manner\r\n    if (!fragmentContext)\r\n        fragmentContext = this.treeAdapter.createElement($.TEMPLATE, NS.HTML, []);\r\n\r\n    //NOTE: create fake element which will be used as 'document' for fragment parsing.\r\n    //This is important for jsdom there 'document' can't be recreated, therefore\r\n    //fragment parsing causes messing of the main `document`.\r\n    var documentMock = this.treeAdapter.createElement('documentmock', NS.HTML, []);\r\n\r\n    this._bootstrap(documentMock, fragmentContext);\r\n\r\n    if (this.treeAdapter.getTagName(fragmentContext) === $.TEMPLATE)\r\n        this._pushTmplInsertionMode(IN_TEMPLATE_MODE);\r\n\r\n    this._initTokenizerForFragmentParsing();\r\n    this._insertFakeRootElement();\r\n    this._resetInsertionMode();\r\n    this._findFormInFragmentContext();\r\n    this.tokenizer.write(html, true);\r\n    this._runParsingLoop(null);\r\n\r\n    var rootElement = this.treeAdapter.getFirstChild(documentMock),\r\n        fragment = this.treeAdapter.createDocumentFragment();\r\n\r\n    this._adoptNodes(rootElement, fragment);\r\n\r\n    return fragment;\r\n};\r\n\r\n//Bootstrap parser\r\nParser.prototype._bootstrap = function (document, fragmentContext) {\r\n    this.tokenizer = new Tokenizer(this.options);\r\n\r\n    this.stopped = false;\r\n\r\n    this.insertionMode = INITIAL_MODE;\r\n    this.originalInsertionMode = '';\r\n\r\n    this.document = document;\r\n    this.fragmentContext = fragmentContext;\r\n\r\n    this.headElement = null;\r\n    this.formElement = null;\r\n\r\n    this.openElements = new OpenElementStack(this.document, this.treeAdapter);\r\n    this.activeFormattingElements = new FormattingElementList(this.treeAdapter);\r\n\r\n    this.tmplInsertionModeStack = [];\r\n    this.tmplInsertionModeStackTop = -1;\r\n    this.currentTmplInsertionMode = null;\r\n\r\n    this.pendingCharacterTokens = [];\r\n    this.hasNonWhitespacePendingCharacterToken = false;\r\n\r\n    this.framesetOk = true;\r\n    this.skipNextNewLine = false;\r\n    this.fosterParentingEnabled = false;\r\n};\r\n\r\n//Parsing loop\r\nParser.prototype._runParsingLoop  = function (scriptHandler) {\r\n    while (!this.stopped) {\r\n        this._setupTokenizerCDATAMode();\r\n\r\n        var token = this.tokenizer.getNextToken();\r\n\r\n        if (token.type === Tokenizer.HIBERNATION_TOKEN)\r\n            break;\r\n\r\n        if (this.skipNextNewLine) {\r\n            this.skipNextNewLine = false;\r\n\r\n            if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN && token.chars[0] === '\\n') {\r\n                if (token.chars.length === 1)\r\n                    continue;\r\n\r\n                token.chars = token.chars.substr(1);\r\n            }\r\n        }\r\n\r\n        this._processInputToken(token);\r\n\r\n        if (scriptHandler && this.pendingScript)\r\n            break;\r\n    }\r\n};\r\n\r\nParser.prototype.runParsingLoopForCurrentChunk = function (writeCallback, scriptHandler) {\r\n    this._runParsingLoop(scriptHandler);\r\n\r\n    if (scriptHandler && this.pendingScript) {\r\n        var script = this.pendingScript;\r\n\r\n        this.pendingScript = null;\r\n\r\n        scriptHandler(script);\r\n\r\n        return;\r\n    }\r\n\r\n    if (writeCallback)\r\n        writeCallback();\r\n};\r\n\r\n//Text parsing\r\nParser.prototype._setupTokenizerCDATAMode = function () {\r\n    var current = this._getAdjustedCurrentElement();\r\n\r\n    this.tokenizer.allowCDATA = current && current !== this.document &&\r\n                                this.treeAdapter.getNamespaceURI(current) !== NS.HTML && !this._isIntegrationPoint(current);\r\n};\r\n\r\nParser.prototype._switchToTextParsing = function (currentToken, nextTokenizerState) {\r\n    this._insertElement(currentToken, NS.HTML);\r\n    this.tokenizer.state = nextTokenizerState;\r\n    this.originalInsertionMode = this.insertionMode;\r\n    this.insertionMode = TEXT_MODE;\r\n};\r\n\r\nParser.prototype.switchToPlaintextParsing = function () {\r\n    this.insertionMode = TEXT_MODE;\r\n    this.originalInsertionMode = IN_BODY_MODE;\r\n    this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n};\r\n\r\n//Fragment parsing\r\nParser.prototype._getAdjustedCurrentElement = function () {\r\n    return this.openElements.stackTop === 0 && this.fragmentContext ?\r\n        this.fragmentContext :\r\n        this.openElements.current;\r\n};\r\n\r\nParser.prototype._findFormInFragmentContext = function () {\r\n    var node = this.fragmentContext;\r\n\r\n    do {\r\n        if (this.treeAdapter.getTagName(node) === $.FORM) {\r\n            this.formElement = node;\r\n            break;\r\n        }\r\n\r\n        node = this.treeAdapter.getParentNode(node);\r\n    } while (node);\r\n};\r\n\r\nParser.prototype._initTokenizerForFragmentParsing = function () {\r\n    if (this.treeAdapter.getNamespaceURI(this.fragmentContext) === NS.HTML) {\r\n        var tn = this.treeAdapter.getTagName(this.fragmentContext);\r\n\r\n        if (tn === $.TITLE || tn === $.TEXTAREA)\r\n            this.tokenizer.state = Tokenizer.MODE.RCDATA;\r\n\r\n        else if (tn === $.STYLE || tn === $.XMP || tn === $.IFRAME ||\r\n                 tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT)\r\n            this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\r\n\r\n        else if (tn === $.SCRIPT)\r\n            this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;\r\n\r\n        else if (tn === $.PLAINTEXT)\r\n            this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n    }\r\n};\r\n\r\n//Tree mutation\r\nParser.prototype._setDocumentType = function (token) {\r\n    this.treeAdapter.setDocumentType(this.document, token.name, token.publicId, token.systemId);\r\n};\r\n\r\nParser.prototype._attachElementToTree = function (element) {\r\n    if (this._shouldFosterParentOnInsertion())\r\n        this._fosterParentElement(element);\r\n\r\n    else {\r\n        var parent = this.openElements.currentTmplContent || this.openElements.current;\r\n\r\n        this.treeAdapter.appendChild(parent, element);\r\n    }\r\n};\r\n\r\nParser.prototype._appendElement = function (token, namespaceURI) {\r\n    var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\r\n\r\n    this._attachElementToTree(element);\r\n};\r\n\r\nParser.prototype._insertElement = function (token, namespaceURI) {\r\n    var element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\r\n\r\n    this._attachElementToTree(element);\r\n    this.openElements.push(element);\r\n};\r\n\r\nParser.prototype._insertFakeElement = function (tagName) {\r\n    var element = this.treeAdapter.createElement(tagName, NS.HTML, []);\r\n\r\n    this._attachElementToTree(element);\r\n    this.openElements.push(element);\r\n};\r\n\r\nParser.prototype._insertTemplate = function (token) {\r\n    var tmpl = this.treeAdapter.createElement(token.tagName, NS.HTML, token.attrs),\r\n        content = this.treeAdapter.createDocumentFragment();\r\n\r\n    this.treeAdapter.setTemplateContent(tmpl, content);\r\n    this._attachElementToTree(tmpl);\r\n    this.openElements.push(tmpl);\r\n};\r\n\r\nParser.prototype._insertFakeRootElement = function () {\r\n    var element = this.treeAdapter.createElement($.HTML, NS.HTML, []);\r\n\r\n    this.treeAdapter.appendChild(this.openElements.current, element);\r\n    this.openElements.push(element);\r\n};\r\n\r\nParser.prototype._appendCommentNode = function (token, parent) {\r\n    var commentNode = this.treeAdapter.createCommentNode(token.data);\r\n\r\n    this.treeAdapter.appendChild(parent, commentNode);\r\n};\r\n\r\nParser.prototype._insertCharacters = function (token) {\r\n    if (this._shouldFosterParentOnInsertion())\r\n        this._fosterParentText(token.chars);\r\n\r\n    else {\r\n        var parent = this.openElements.currentTmplContent || this.openElements.current;\r\n\r\n        this.treeAdapter.insertText(parent, token.chars);\r\n    }\r\n};\r\n\r\nParser.prototype._adoptNodes = function (donor, recipient) {\r\n    while (true) {\r\n        var child = this.treeAdapter.getFirstChild(donor);\r\n\r\n        if (!child)\r\n            break;\r\n\r\n        this.treeAdapter.detachNode(child);\r\n        this.treeAdapter.appendChild(recipient, child);\r\n    }\r\n};\r\n\r\n//Token processing\r\nParser.prototype._shouldProcessTokenInForeignContent = function (token) {\r\n    var current = this._getAdjustedCurrentElement();\r\n\r\n    if (!current || current === this.document)\r\n        return false;\r\n\r\n    var ns = this.treeAdapter.getNamespaceURI(current);\r\n\r\n    if (ns === NS.HTML)\r\n        return false;\r\n\r\n    if (this.treeAdapter.getTagName(current) === $.ANNOTATION_XML && ns === NS.MATHML &&\r\n        token.type === Tokenizer.START_TAG_TOKEN && token.tagName === $.SVG)\r\n        return false;\r\n\r\n    var isCharacterToken = token.type === Tokenizer.CHARACTER_TOKEN ||\r\n                           token.type === Tokenizer.NULL_CHARACTER_TOKEN ||\r\n                           token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN,\r\n        isMathMLTextStartTag = token.type === Tokenizer.START_TAG_TOKEN &&\r\n                               token.tagName !== $.MGLYPH &&\r\n                               token.tagName !== $.MALIGNMARK;\r\n\r\n    if ((isMathMLTextStartTag || isCharacterToken) && this._isIntegrationPoint(current, NS.MATHML))\r\n        return false;\r\n\r\n    if ((token.type === Tokenizer.START_TAG_TOKEN || isCharacterToken) && this._isIntegrationPoint(current, NS.HTML))\r\n        return false;\r\n\r\n    return token.type !== Tokenizer.EOF_TOKEN;\r\n};\r\n\r\nParser.prototype._processToken = function (token) {\r\n    _[this.insertionMode][token.type](this, token);\r\n};\r\n\r\nParser.prototype._processTokenInBodyMode = function (token) {\r\n    _[IN_BODY_MODE][token.type](this, token);\r\n};\r\n\r\nParser.prototype._processTokenInForeignContent = function (token) {\r\n    if (token.type === Tokenizer.CHARACTER_TOKEN)\r\n        characterInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN)\r\n        nullCharacterInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.WHITESPACE_CHARACTER_TOKEN)\r\n        insertCharacters(this, token);\r\n\r\n    else if (token.type === Tokenizer.COMMENT_TOKEN)\r\n        appendComment(this, token);\r\n\r\n    else if (token.type === Tokenizer.START_TAG_TOKEN)\r\n        startTagInForeignContent(this, token);\r\n\r\n    else if (token.type === Tokenizer.END_TAG_TOKEN)\r\n        endTagInForeignContent(this, token);\r\n};\r\n\r\nParser.prototype._processInputToken = function (token) {\r\n    if (this._shouldProcessTokenInForeignContent(token))\r\n        this._processTokenInForeignContent(token);\r\n\r\n    else\r\n        this._processToken(token);\r\n};\r\n\r\n//Integration points\r\nParser.prototype._isIntegrationPoint = function (element, foreignNS) {\r\n    var tn = this.treeAdapter.getTagName(element),\r\n        ns = this.treeAdapter.getNamespaceURI(element),\r\n        attrs = this.treeAdapter.getAttrList(element);\r\n\r\n    return foreignContent.isIntegrationPoint(tn, ns, attrs, foreignNS);\r\n};\r\n\r\n//Active formatting elements reconstruction\r\nParser.prototype._reconstructActiveFormattingElements = function () {\r\n    var listLength = this.activeFormattingElements.length;\r\n\r\n    if (listLength) {\r\n        var unopenIdx = listLength,\r\n            entry = null;\r\n\r\n        do {\r\n            unopenIdx--;\r\n            entry = this.activeFormattingElements.entries[unopenIdx];\r\n\r\n            if (entry.type === FormattingElementList.MARKER_ENTRY || this.openElements.contains(entry.element)) {\r\n                unopenIdx++;\r\n                break;\r\n            }\r\n        } while (unopenIdx > 0);\r\n\r\n        for (var i = unopenIdx; i < listLength; i++) {\r\n            entry = this.activeFormattingElements.entries[i];\r\n            this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\r\n            entry.element = this.openElements.current;\r\n        }\r\n    }\r\n};\r\n\r\n//Close elements\r\nParser.prototype._closeTableCell = function () {\r\n    this.openElements.generateImpliedEndTags();\r\n    this.openElements.popUntilTableCellPopped();\r\n    this.activeFormattingElements.clearToLastMarker();\r\n    this.insertionMode = IN_ROW_MODE;\r\n};\r\n\r\nParser.prototype._closePElement = function () {\r\n    this.openElements.generateImpliedEndTagsWithExclusion($.P);\r\n    this.openElements.popUntilTagNamePopped($.P);\r\n};\r\n\r\n//Insertion modes\r\nParser.prototype._resetInsertionMode = function () {\r\n    for (var i = this.openElements.stackTop, last = false; i >= 0; i--) {\r\n        var element = this.openElements.items[i];\r\n\r\n        if (i === 0) {\r\n            last = true;\r\n\r\n            if (this.fragmentContext)\r\n                element = this.fragmentContext;\r\n        }\r\n\r\n        var tn = this.treeAdapter.getTagName(element),\r\n            newInsertionMode = INSERTION_MODE_RESET_MAP[tn];\r\n\r\n        if (newInsertionMode) {\r\n            this.insertionMode = newInsertionMode;\r\n            break;\r\n        }\r\n\r\n        else if (!last && (tn === $.TD || tn === $.TH)) {\r\n            this.insertionMode = IN_CELL_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (!last && tn === $.HEAD) {\r\n            this.insertionMode = IN_HEAD_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.SELECT) {\r\n            this._resetInsertionModeForSelect(i);\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.TEMPLATE) {\r\n            this.insertionMode = this.currentTmplInsertionMode;\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.HTML) {\r\n            this.insertionMode = this.headElement ? AFTER_HEAD_MODE : BEFORE_HEAD_MODE;\r\n            break;\r\n        }\r\n\r\n        else if (last) {\r\n            this.insertionMode = IN_BODY_MODE;\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\nParser.prototype._resetInsertionModeForSelect = function (selectIdx) {\r\n    if (selectIdx > 0) {\r\n        for (var i = selectIdx - 1; i > 0; i--) {\r\n            var ancestor = this.openElements.items[i],\r\n                tn = this.treeAdapter.getTagName(ancestor);\r\n\r\n            if (tn === $.TEMPLATE)\r\n                break;\r\n\r\n            else if (tn === $.TABLE) {\r\n                this.insertionMode = IN_SELECT_IN_TABLE_MODE;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    this.insertionMode = IN_SELECT_MODE;\r\n};\r\n\r\nParser.prototype._pushTmplInsertionMode = function (mode) {\r\n    this.tmplInsertionModeStack.push(mode);\r\n    this.tmplInsertionModeStackTop++;\r\n    this.currentTmplInsertionMode = mode;\r\n};\r\n\r\nParser.prototype._popTmplInsertionMode = function () {\r\n    this.tmplInsertionModeStack.pop();\r\n    this.tmplInsertionModeStackTop--;\r\n    this.currentTmplInsertionMode = this.tmplInsertionModeStack[this.tmplInsertionModeStackTop];\r\n};\r\n\r\n//Foster parenting\r\nParser.prototype._isElementCausesFosterParenting = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element);\r\n\r\n    return tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR;\r\n};\r\n\r\nParser.prototype._shouldFosterParentOnInsertion = function () {\r\n    return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.current);\r\n};\r\n\r\nParser.prototype._findFosterParentingLocation = function () {\r\n    var location = {\r\n        parent: null,\r\n        beforeElement: null\r\n    };\r\n\r\n    for (var i = this.openElements.stackTop; i >= 0; i--) {\r\n        var openElement = this.openElements.items[i],\r\n            tn = this.treeAdapter.getTagName(openElement),\r\n            ns = this.treeAdapter.getNamespaceURI(openElement);\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML) {\r\n            location.parent = this.treeAdapter.getTemplateContent(openElement);\r\n            break;\r\n        }\r\n\r\n        else if (tn === $.TABLE) {\r\n            location.parent = this.treeAdapter.getParentNode(openElement);\r\n\r\n            if (location.parent)\r\n                location.beforeElement = openElement;\r\n            else\r\n                location.parent = this.openElements.items[i - 1];\r\n\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (!location.parent)\r\n        location.parent = this.openElements.items[0];\r\n\r\n    return location;\r\n};\r\n\r\nParser.prototype._fosterParentElement = function (element) {\r\n    var location = this._findFosterParentingLocation();\r\n\r\n    if (location.beforeElement)\r\n        this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\r\n    else\r\n        this.treeAdapter.appendChild(location.parent, element);\r\n};\r\n\r\nParser.prototype._fosterParentText = function (chars) {\r\n    var location = this._findFosterParentingLocation();\r\n\r\n    if (location.beforeElement)\r\n        this.treeAdapter.insertTextBefore(location.parent, chars, location.beforeElement);\r\n    else\r\n        this.treeAdapter.insertText(location.parent, chars);\r\n};\r\n\r\n//Special elements\r\nParser.prototype._isSpecialElement = function (element) {\r\n    var tn = this.treeAdapter.getTagName(element),\r\n        ns = this.treeAdapter.getNamespaceURI(element);\r\n\r\n    return HTML.SPECIAL_ELEMENTS[ns][tn];\r\n};\r\n\r\n//Adoption agency algorithm\r\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\r\n//------------------------------------------------------------------\r\n\r\n//Steps 5-8 of the algorithm\r\nfunction aaObtainFormattingElementEntry(p, token) {\r\n    var formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\r\n\r\n    if (formattingElementEntry) {\r\n        if (!p.openElements.contains(formattingElementEntry.element)) {\r\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n            formattingElementEntry = null;\r\n        }\r\n\r\n        else if (!p.openElements.hasInScope(token.tagName))\r\n            formattingElementEntry = null;\r\n    }\r\n\r\n    else\r\n        genericEndTagInBody(p, token);\r\n\r\n    return formattingElementEntry;\r\n}\r\n\r\n//Steps 9 and 10 of the algorithm\r\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\r\n    var furthestBlock = null;\r\n\r\n    for (var i = p.openElements.stackTop; i >= 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (element === formattingElementEntry.element)\r\n            break;\r\n\r\n        if (p._isSpecialElement(element))\r\n            furthestBlock = element;\r\n    }\r\n\r\n    if (!furthestBlock) {\r\n        p.openElements.popUntilElementPopped(formattingElementEntry.element);\r\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n    }\r\n\r\n    return furthestBlock;\r\n}\r\n\r\n//Step 13 of the algorithm\r\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\r\n    var lastElement = furthestBlock,\r\n        nextElement = p.openElements.getCommonAncestor(furthestBlock);\r\n\r\n    for (var i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\r\n        //NOTE: store next element for the next loop iteration (it may be deleted from the stack by step 9.5)\r\n        nextElement = p.openElements.getCommonAncestor(element);\r\n\r\n        var elementEntry = p.activeFormattingElements.getElementEntry(element),\r\n            counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER,\r\n            shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\r\n\r\n        if (shouldRemoveFromOpenElements) {\r\n            if (counterOverflow)\r\n                p.activeFormattingElements.removeEntry(elementEntry);\r\n\r\n            p.openElements.remove(element);\r\n        }\r\n\r\n        else {\r\n            element = aaRecreateElementFromEntry(p, elementEntry);\r\n\r\n            if (lastElement === furthestBlock)\r\n                p.activeFormattingElements.bookmark = elementEntry;\r\n\r\n            p.treeAdapter.detachNode(lastElement);\r\n            p.treeAdapter.appendChild(element, lastElement);\r\n            lastElement = element;\r\n        }\r\n    }\r\n\r\n    return lastElement;\r\n}\r\n\r\n//Step 13.7 of the algorithm\r\nfunction aaRecreateElementFromEntry(p, elementEntry) {\r\n    var ns = p.treeAdapter.getNamespaceURI(elementEntry.element),\r\n        newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\r\n\r\n    p.openElements.replace(elementEntry.element, newElement);\r\n    elementEntry.element = newElement;\r\n\r\n    return newElement;\r\n}\r\n\r\n//Step 14 of the algorithm\r\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\r\n    if (p._isElementCausesFosterParenting(commonAncestor))\r\n        p._fosterParentElement(lastElement);\r\n\r\n    else {\r\n        var tn = p.treeAdapter.getTagName(commonAncestor),\r\n            ns = p.treeAdapter.getNamespaceURI(commonAncestor);\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML)\r\n            commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\r\n\r\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\r\n    }\r\n}\r\n\r\n//Steps 15-19 of the algorithm\r\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\r\n    var ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element),\r\n        token = formattingElementEntry.token,\r\n        newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\r\n\r\n    p._adoptNodes(furthestBlock, newElement);\r\n    p.treeAdapter.appendChild(furthestBlock, newElement);\r\n\r\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, formattingElementEntry.token);\r\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\r\n\r\n    p.openElements.remove(formattingElementEntry.element);\r\n    p.openElements.insertAfter(furthestBlock, newElement);\r\n}\r\n\r\n//Algorithm entry point\r\nfunction callAdoptionAgency(p, token) {\r\n    var formattingElementEntry;\r\n\r\n    for (var i = 0; i < AA_OUTER_LOOP_ITER; i++) {\r\n        formattingElementEntry = aaObtainFormattingElementEntry(p, token, formattingElementEntry);\r\n\r\n        if (!formattingElementEntry)\r\n            break;\r\n\r\n        var furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\r\n\r\n        if (!furthestBlock)\r\n            break;\r\n\r\n        p.activeFormattingElements.bookmark = formattingElementEntry;\r\n\r\n        var lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element),\r\n            commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\r\n\r\n        p.treeAdapter.detachNode(lastElement);\r\n        aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\r\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\r\n    }\r\n}\r\n\r\n\r\n//Generic token handlers\r\n//------------------------------------------------------------------\r\nfunction ignoreToken() {\r\n    //NOTE: do nothing =)\r\n}\r\n\r\nfunction appendComment(p, token) {\r\n    p._appendCommentNode(token, p.openElements.currentTmplContent || p.openElements.current);\r\n}\r\n\r\nfunction appendCommentToRootHtmlElement(p, token) {\r\n    p._appendCommentNode(token, p.openElements.items[0]);\r\n}\r\n\r\nfunction appendCommentToDocument(p, token) {\r\n    p._appendCommentNode(token, p.document);\r\n}\r\n\r\nfunction insertCharacters(p, token) {\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction stopParsing(p) {\r\n    p.stopped = true;\r\n}\r\n\r\n//12.2.5.4.1 The \"initial\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction doctypeInInitialMode(p, token) {\r\n    p._setDocumentType(token);\r\n\r\n    var mode = token.forceQuirks ?\r\n        HTML.DOCUMENT_MODE.QUIRKS :\r\n        doctype.getDocumentMode(token.name, token.publicId, token.systemId);\r\n\r\n    p.treeAdapter.setDocumentMode(p.document, mode);\r\n\r\n    p.insertionMode = BEFORE_HTML_MODE;\r\n}\r\n\r\nfunction tokenInInitialMode(p, token) {\r\n    p.treeAdapter.setDocumentMode(p.document, HTML.DOCUMENT_MODE.QUIRKS);\r\n    p.insertionMode = BEFORE_HTML_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.2 The \"before html\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagBeforeHtml(p, token) {\r\n    if (token.tagName === $.HTML) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = BEFORE_HEAD_MODE;\r\n    }\r\n\r\n    else\r\n        tokenBeforeHtml(p, token);\r\n}\r\n\r\nfunction endTagBeforeHtml(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML || tn === $.HEAD || tn === $.BODY || tn === $.BR)\r\n        tokenBeforeHtml(p, token);\r\n}\r\n\r\nfunction tokenBeforeHtml(p, token) {\r\n    p._insertFakeRootElement();\r\n    p.insertionMode = BEFORE_HEAD_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.3 The \"before head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagBeforeHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.HEAD) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.headElement = p.openElements.current;\r\n        p.insertionMode = IN_HEAD_MODE;\r\n    }\r\n\r\n    else\r\n        tokenBeforeHead(p, token);\r\n}\r\n\r\nfunction endTagBeforeHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HEAD || tn === $.BODY || tn === $.HTML || tn === $.BR)\r\n        tokenBeforeHead(p, token);\r\n}\r\n\r\nfunction tokenBeforeHead(p, token) {\r\n    p._insertFakeElement($.HEAD);\r\n    p.headElement = p.openElements.current;\r\n    p.insertionMode = IN_HEAD_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.4 The \"in head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else if (tn === $.TITLE)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.RCDATA);\r\n\r\n    //NOTE: here we assume that we always act as an interactive user agent with enabled scripting, so we parse\r\n    //<noscript> as a rawtext.\r\n    else if (tn === $.NOSCRIPT || tn === $.NOFRAMES || tn === $.STYLE)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n\r\n    else if (tn === $.SCRIPT)\r\n        p._switchToTextParsing(token, Tokenizer.MODE.SCRIPT_DATA);\r\n\r\n    else if (tn === $.TEMPLATE) {\r\n        p._insertTemplate(token, NS.HTML);\r\n        p.activeFormattingElements.insertMarker();\r\n        p.framesetOk = false;\r\n        p.insertionMode = IN_TEMPLATE_MODE;\r\n        p._pushTmplInsertionMode(IN_TEMPLATE_MODE);\r\n    }\r\n\r\n    else if (tn !== $.HEAD)\r\n        tokenInHead(p, token);\r\n}\r\n\r\nfunction endTagInHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HEAD) {\r\n        p.openElements.pop();\r\n        p.insertionMode = AFTER_HEAD_MODE;\r\n    }\r\n\r\n    else if (tn === $.BODY || tn === $.BR || tn === $.HTML)\r\n        tokenInHead(p, token);\r\n\r\n    else if (tn === $.TEMPLATE && p.openElements.tmplCount > 0) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\r\n        p.activeFormattingElements.clearToLastMarker();\r\n        p._popTmplInsertionMode();\r\n        p._resetInsertionMode();\r\n    }\r\n}\r\n\r\nfunction tokenInHead(p, token) {\r\n    p.openElements.pop();\r\n    p.insertionMode = AFTER_HEAD_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.6 The \"after head\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.BODY) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.framesetOk = false;\r\n        p.insertionMode = IN_BODY_MODE;\r\n    }\r\n\r\n    else if (tn === $.FRAMESET) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_FRAMESET_MODE;\r\n    }\r\n\r\n    else if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META ||\r\n             tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE) {\r\n        p.openElements.push(p.headElement);\r\n        startTagInHead(p, token);\r\n        p.openElements.remove(p.headElement);\r\n    }\r\n\r\n    else if (tn !== $.HEAD)\r\n        tokenAfterHead(p, token);\r\n}\r\n\r\nfunction endTagAfterHead(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.BODY || tn === $.HTML || tn === $.BR)\r\n        tokenAfterHead(p, token);\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\nfunction tokenAfterHead(p, token) {\r\n    p._insertFakeElement($.BODY);\r\n    p.insertionMode = IN_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.7 The \"in body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction whitespaceCharacterInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction characterInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertCharacters(token);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction htmlStartTagInBody(p, token) {\r\n    if (p.openElements.tmplCount === 0)\r\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\r\n}\r\n\r\nfunction bodyStartTagInBody(p, token) {\r\n    var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\r\n\r\n    if (bodyElement && p.openElements.tmplCount === 0) {\r\n        p.framesetOk = false;\r\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\r\n    }\r\n}\r\n\r\nfunction framesetStartTagInBody(p, token) {\r\n    var bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\r\n\r\n    if (p.framesetOk && bodyElement) {\r\n        p.treeAdapter.detachNode(bodyElement);\r\n        p.openElements.popAllUpToHtmlElement();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_FRAMESET_MODE;\r\n    }\r\n}\r\n\r\nfunction addressStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction numberedHeaderStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    var tn = p.openElements.currentTagName;\r\n\r\n    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n        p.openElements.pop();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction preStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\r\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\r\n    p.skipNextNewLine = true;\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction formStartTagInBody(p, token) {\r\n    var inTemplate = p.openElements.tmplCount > 0;\r\n\r\n    if (!p.formElement || inTemplate) {\r\n        if (p.openElements.hasInButtonScope($.P))\r\n            p._closePElement();\r\n\r\n        p._insertElement(token, NS.HTML);\r\n\r\n        if (!inTemplate)\r\n            p.formElement = p.openElements.current;\r\n    }\r\n}\r\n\r\nfunction listItemStartTagInBody(p, token) {\r\n    p.framesetOk = false;\r\n\r\n    var tn = token.tagName;\r\n\r\n    for (var i = p.openElements.stackTop; i >= 0; i--) {\r\n        var element = p.openElements.items[i],\r\n            elementTn = p.treeAdapter.getTagName(element),\r\n            closeTn = null;\r\n\r\n        if (tn === $.LI && elementTn === $.LI)\r\n            closeTn = $.LI;\r\n\r\n        else if ((tn === $.DD || tn === $.DT) && (elementTn === $.DD || elementTn === $.DT))\r\n            closeTn = elementTn;\r\n\r\n        if (closeTn) {\r\n            p.openElements.generateImpliedEndTagsWithExclusion(closeTn);\r\n            p.openElements.popUntilTagNamePopped(closeTn);\r\n            break;\r\n        }\r\n\r\n        if (elementTn !== $.ADDRESS && elementTn !== $.DIV && elementTn !== $.P && p._isSpecialElement(element))\r\n            break;\r\n    }\r\n\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction plaintextStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n}\r\n\r\nfunction buttonStartTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.BUTTON)) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped($.BUTTON);\r\n    }\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction aStartTagInBody(p, token) {\r\n    var activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName($.A);\r\n\r\n    if (activeElementEntry) {\r\n        callAdoptionAgency(p, token);\r\n        p.openElements.remove(activeElementEntry.element);\r\n        p.activeFormattingElements.removeEntry(activeElementEntry);\r\n    }\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction bStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction nobrStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    if (p.openElements.hasInScope($.NOBR)) {\r\n        callAdoptionAgency(p, token);\r\n        p._reconstructActiveFormattingElements();\r\n    }\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\r\n}\r\n\r\nfunction appletStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.activeFormattingElements.insertMarker();\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction tableStartTagInBody(p, token) {\r\n    if (p.treeAdapter.getDocumentMode(p.document) !== HTML.DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n    p.insertionMode = IN_TABLE_MODE;\r\n}\r\n\r\nfunction areaStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._appendElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction inputStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._appendElement(token, NS.HTML);\r\n\r\n    var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\r\n\r\n    if (!inputType || inputType.toLowerCase() !== HIDDEN_INPUT_TYPE)\r\n        p.framesetOk = false;\r\n\r\n}\r\n\r\nfunction paramStartTagInBody(p, token) {\r\n    p._appendElement(token, NS.HTML);\r\n}\r\n\r\nfunction hrStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    if (p.openElements.currentTagName === $.MENUITEM)\r\n        p.openElements.pop();\r\n\r\n    p._appendElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction imageStartTagInBody(p, token) {\r\n    token.tagName = $.IMG;\r\n    areaStartTagInBody(p, token);\r\n}\r\n\r\nfunction textareaStartTagInBody(p, token) {\r\n    p._insertElement(token, NS.HTML);\r\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\r\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\r\n    p.skipNextNewLine = true;\r\n    p.tokenizer.state = Tokenizer.MODE.RCDATA;\r\n    p.originalInsertionMode = p.insertionMode;\r\n    p.framesetOk = false;\r\n    p.insertionMode = TEXT_MODE;\r\n}\r\n\r\nfunction xmpStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p.framesetOk = false;\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\nfunction iframeStartTagInBody(p, token) {\r\n    p.framesetOk = false;\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\r\n//<noembed> as a rawtext.\r\nfunction noembedStartTagInBody(p, token) {\r\n    p._switchToTextParsing(token, Tokenizer.MODE.RAWTEXT);\r\n}\r\n\r\nfunction selectStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n    p.framesetOk = false;\r\n\r\n    if (p.insertionMode === IN_TABLE_MODE ||\r\n        p.insertionMode === IN_CAPTION_MODE ||\r\n        p.insertionMode === IN_TABLE_BODY_MODE ||\r\n        p.insertionMode === IN_ROW_MODE ||\r\n        p.insertionMode === IN_CELL_MODE)\r\n\r\n        p.insertionMode = IN_SELECT_IN_TABLE_MODE;\r\n\r\n    else\r\n        p.insertionMode = IN_SELECT_MODE;\r\n}\r\n\r\nfunction optgroupStartTagInBody(p, token) {\r\n    if (p.openElements.currentTagName === $.OPTION)\r\n        p.openElements.pop();\r\n\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction rbStartTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.RUBY))\r\n        p.openElements.generateImpliedEndTags();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction rtStartTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.RUBY))\r\n        p.openElements.generateImpliedEndTagsWithExclusion($.RTC);\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction menuitemStartTagInBody(p, token) {\r\n    if (p.openElements.currentTagName === $.MENUITEM)\r\n        p.openElements.pop();\r\n\r\n    // TODO needs clarification, see https://github.com/whatwg/html/pull/907/files#r73505877\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction menuStartTagInBody(p, token) {\r\n    if (p.openElements.hasInButtonScope($.P))\r\n        p._closePElement();\r\n\r\n    if (p.openElements.currentTagName === $.MENUITEM)\r\n        p.openElements.pop();\r\n\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\nfunction mathStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    foreignContent.adjustTokenMathMLAttrs(token);\r\n    foreignContent.adjustTokenXMLAttrs(token);\r\n\r\n    if (token.selfClosing)\r\n        p._appendElement(token, NS.MATHML);\r\n    else\r\n        p._insertElement(token, NS.MATHML);\r\n}\r\n\r\nfunction svgStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n\r\n    foreignContent.adjustTokenSVGAttrs(token);\r\n    foreignContent.adjustTokenXMLAttrs(token);\r\n\r\n    if (token.selfClosing)\r\n        p._appendElement(token, NS.SVG);\r\n    else\r\n        p._insertElement(token, NS.SVG);\r\n}\r\n\r\nfunction genericStartTagInBody(p, token) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertElement(token, NS.HTML);\r\n}\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction startTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 1:\r\n            if (tn === $.I || tn === $.S || tn === $.B || tn === $.U)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.P)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.A)\r\n                aStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 2:\r\n            if (tn === $.DL || tn === $.OL || tn === $.UL)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n                numberedHeaderStartTagInBody(p, token);\r\n\r\n            else if (tn === $.LI || tn === $.DD || tn === $.DT)\r\n                listItemStartTagInBody(p, token);\r\n\r\n            else if (tn === $.EM || tn === $.TT)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BR)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.HR)\r\n                hrStartTagInBody(p, token);\r\n\r\n            else if (tn === $.RB)\r\n                rbStartTagInBody(p, token);\r\n\r\n            else if (tn === $.RT || tn === $.RP)\r\n                rtStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.TH && tn !== $.TD && tn !== $.TR)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.DIV || tn === $.DIR || tn === $.NAV)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.PRE)\r\n                preStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BIG)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IMG || tn === $.WBR)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.XMP)\r\n                xmpStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SVG)\r\n                svgStartTagInBody(p, token);\r\n\r\n            else if (tn === $.RTC)\r\n                rbStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.COL)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.HTML)\r\n                htmlStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BASE || tn === $.LINK || tn === $.META)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.BODY)\r\n                bodyStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MAIN)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FORM)\r\n                formStartTagInBody(p, token);\r\n\r\n            else if (tn === $.CODE || tn === $.FONT)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.NOBR)\r\n                nobrStartTagInBody(p, token);\r\n\r\n            else if (tn === $.AREA)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MATH)\r\n                mathStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MENU)\r\n                menuStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.HEAD)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.STYLE || tn === $.TITLE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.ASIDE)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SMALL)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TABLE)\r\n                tableStartTagInBody(p, token);\r\n\r\n            else if (tn === $.EMBED)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.INPUT)\r\n                inputStartTagInBody(p, token);\r\n\r\n            else if (tn === $.PARAM || tn === $.TRACK)\r\n                paramStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IMAGE)\r\n                imageStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.FRAME && tn !== $.TBODY && tn !== $.TFOOT && tn !== $.THEAD)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.SCRIPT)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.BUTTON)\r\n                buttonStartTagInBody(p, token);\r\n\r\n            else if (tn === $.STRIKE || tn === $.STRONG)\r\n                bStartTagInBody(p, token);\r\n\r\n            else if (tn === $.APPLET || tn === $.OBJECT)\r\n                appletStartTagInBody(p, token);\r\n\r\n            else if (tn === $.KEYGEN)\r\n                areaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SOURCE)\r\n                paramStartTagInBody(p, token);\r\n\r\n            else if (tn === $.IFRAME)\r\n                iframeStartTagInBody(p, token);\r\n\r\n            else if (tn === $.SELECT)\r\n                selectStartTagInBody(p, token);\r\n\r\n            else if (tn === $.OPTION)\r\n                optgroupStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.BGSOUND)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.DETAILS || tn === $.ADDRESS || tn === $.ARTICLE || tn === $.SECTION || tn === $.SUMMARY)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.LISTING)\r\n                preStartTagInBody(p, token);\r\n\r\n            else if (tn === $.MARQUEE)\r\n                appletStartTagInBody(p, token);\r\n\r\n            else if (tn === $.NOEMBED)\r\n                noembedStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.CAPTION)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.BASEFONT)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.MENUITEM)\r\n                menuitemStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FRAMESET)\r\n                framesetStartTagInBody(p, token);\r\n\r\n            else if (tn === $.FIELDSET)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TEXTAREA)\r\n                textareaStartTagInBody(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.NOSCRIPT)\r\n                noembedStartTagInBody(p, token);\r\n\r\n            else if (tn === $.OPTGROUP)\r\n                optgroupStartTagInBody(p, token);\r\n\r\n            else if (tn !== $.COLGROUP)\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 9:\r\n            if (tn === $.PLAINTEXT)\r\n                plaintextStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 10:\r\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION)\r\n                addressStartTagInBody(p, token);\r\n\r\n            else\r\n                genericStartTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        default:\r\n            genericStartTagInBody(p, token);\r\n    }\r\n}\r\n\r\nfunction bodyEndTagInBody(p) {\r\n    if (p.openElements.hasInScope($.BODY))\r\n        p.insertionMode = AFTER_BODY_MODE;\r\n}\r\n\r\nfunction htmlEndTagInBody(p, token) {\r\n    if (p.openElements.hasInScope($.BODY)) {\r\n        p.insertionMode = AFTER_BODY_MODE;\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\nfunction addressEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n    }\r\n}\r\n\r\nfunction formEndTagInBody(p) {\r\n    var inTemplate = p.openElements.tmplCount > 0,\r\n        formElement = p.formElement;\r\n\r\n    if (!inTemplate)\r\n        p.formElement = null;\r\n\r\n    if ((formElement || inTemplate) && p.openElements.hasInScope($.FORM)) {\r\n        p.openElements.generateImpliedEndTags();\r\n\r\n        if (inTemplate)\r\n            p.openElements.popUntilTagNamePopped($.FORM);\r\n\r\n        else\r\n            p.openElements.remove(formElement);\r\n    }\r\n}\r\n\r\nfunction pEndTagInBody(p) {\r\n    if (!p.openElements.hasInButtonScope($.P))\r\n        p._insertFakeElement($.P);\r\n\r\n    p._closePElement();\r\n}\r\n\r\nfunction liEndTagInBody(p) {\r\n    if (p.openElements.hasInListItemScope($.LI)) {\r\n        p.openElements.generateImpliedEndTagsWithExclusion($.LI);\r\n        p.openElements.popUntilTagNamePopped($.LI);\r\n    }\r\n}\r\n\r\nfunction ddEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n    }\r\n}\r\n\r\nfunction numberedHeaderEndTagInBody(p) {\r\n    if (p.openElements.hasNumberedHeaderInScope()) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilNumberedHeaderPopped();\r\n    }\r\n}\r\n\r\nfunction appletEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (p.openElements.hasInScope(tn)) {\r\n        p.openElements.generateImpliedEndTags();\r\n        p.openElements.popUntilTagNamePopped(tn);\r\n        p.activeFormattingElements.clearToLastMarker();\r\n    }\r\n}\r\n\r\nfunction brEndTagInBody(p) {\r\n    p._reconstructActiveFormattingElements();\r\n    p._insertFakeElement($.BR);\r\n    p.openElements.pop();\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction genericEndTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    for (var i = p.openElements.stackTop; i > 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (p.treeAdapter.getTagName(element) === tn) {\r\n            p.openElements.generateImpliedEndTagsWithExclusion(tn);\r\n            p.openElements.popUntilElementPopped(element);\r\n            break;\r\n        }\r\n\r\n        if (p._isSpecialElement(element))\r\n            break;\r\n    }\r\n}\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction endTagInBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 1:\r\n            if (tn === $.A || tn === $.B || tn === $.I || tn === $.S || tn === $.U)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.P)\r\n                pEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 2:\r\n            if (tn === $.DL || tn === $.UL || tn === $.OL)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.LI)\r\n                liEndTagInBody(p, token);\r\n\r\n            else if (tn === $.DD || tn === $.DT)\r\n                ddEndTagInBody(p, token);\r\n\r\n            else if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n                numberedHeaderEndTagInBody(p, token);\r\n\r\n            else if (tn === $.BR)\r\n                brEndTagInBody(p, token);\r\n\r\n            else if (tn === $.EM || tn === $.TT)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.BIG)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.DIR || tn === $.DIV || tn === $.NAV)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.BODY)\r\n                bodyEndTagInBody(p, token);\r\n\r\n            else if (tn === $.HTML)\r\n                htmlEndTagInBody(p, token);\r\n\r\n            else if (tn === $.FORM)\r\n                formEndTagInBody(p, token);\r\n\r\n            else if (tn === $.CODE || tn === $.FONT || tn === $.NOBR)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else if (tn === $.MAIN || tn === $.MENU)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.ASIDE)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.SMALL)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.CENTER || tn === $.FIGURE || tn === $.FOOTER || tn === $.HEADER || tn === $.HGROUP)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.APPLET || tn === $.OBJECT)\r\n                appletEndTagInBody(p, token);\r\n\r\n            else if (tn === $.STRIKE || tn === $.STRONG)\r\n                callAdoptionAgency(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.ADDRESS || tn === $.ARTICLE || tn === $.DETAILS || tn === $.SECTION || tn === $.SUMMARY)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.MARQUEE)\r\n                appletEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.FIELDSET)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                endTagInHead(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        case 10:\r\n            if (tn === $.BLOCKQUOTE || tn === $.FIGCAPTION)\r\n                addressEndTagInBody(p, token);\r\n\r\n            else\r\n                genericEndTagInBody(p, token);\r\n\r\n            break;\r\n\r\n        default :\r\n            genericEndTagInBody(p, token);\r\n    }\r\n}\r\n\r\nfunction eofInBody(p, token) {\r\n    if (p.tmplInsertionModeStackTop > -1)\r\n        eofInTemplate(p, token);\r\n\r\n    else\r\n        p.stopped = true;\r\n}\r\n\r\n//12.2.5.4.8 The \"text\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction endTagInText(p, token) {\r\n    if (token.tagName === $.SCRIPT)\r\n        p.pendingScript = p.openElements.current;\r\n\r\n    p.openElements.pop();\r\n    p.insertionMode = p.originalInsertionMode;\r\n}\r\n\r\n\r\nfunction eofInText(p, token) {\r\n    p.openElements.pop();\r\n    p.insertionMode = p.originalInsertionMode;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.9 The \"in table\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction characterInTable(p, token) {\r\n    var curTn = p.openElements.currentTagName;\r\n\r\n    if (curTn === $.TABLE || curTn === $.TBODY || curTn === $.TFOOT || curTn === $.THEAD || curTn === $.TR) {\r\n        p.pendingCharacterTokens = [];\r\n        p.hasNonWhitespacePendingCharacterToken = false;\r\n        p.originalInsertionMode = p.insertionMode;\r\n        p.insertionMode = IN_TABLE_TEXT_MODE;\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        tokenInTable(p, token);\r\n}\r\n\r\nfunction captionStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p.activeFormattingElements.insertMarker();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_CAPTION_MODE;\r\n}\r\n\r\nfunction colgroupStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_COLUMN_GROUP_MODE;\r\n}\r\n\r\nfunction colStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertFakeElement($.COLGROUP);\r\n    p.insertionMode = IN_COLUMN_GROUP_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\nfunction tbodyStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertElement(token, NS.HTML);\r\n    p.insertionMode = IN_TABLE_BODY_MODE;\r\n}\r\n\r\nfunction tdStartTagInTable(p, token) {\r\n    p.openElements.clearBackToTableContext();\r\n    p._insertFakeElement($.TBODY);\r\n    p.insertionMode = IN_TABLE_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\nfunction tableStartTagInTable(p, token) {\r\n    if (p.openElements.hasInTableScope($.TABLE)) {\r\n        p.openElements.popUntilTagNamePopped($.TABLE);\r\n        p._resetInsertionMode();\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\nfunction inputStartTagInTable(p, token) {\r\n    var inputType = Tokenizer.getTokenAttr(token, ATTRS.TYPE);\r\n\r\n    if (inputType && inputType.toLowerCase() === HIDDEN_INPUT_TYPE)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else\r\n        tokenInTable(p, token);\r\n}\r\n\r\nfunction formStartTagInTable(p, token) {\r\n    if (!p.formElement && p.openElements.tmplCount === 0) {\r\n        p._insertElement(token, NS.HTML);\r\n        p.formElement = p.openElements.current;\r\n        p.openElements.pop();\r\n    }\r\n}\r\n\r\nfunction startTagInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    switch (tn.length) {\r\n        case 2:\r\n            if (tn === $.TD || tn === $.TH || tn === $.TR)\r\n                tdStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 3:\r\n            if (tn === $.COL)\r\n                colStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.FORM)\r\n                formStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.TABLE)\r\n                tableStartTagInTable(p, token);\r\n\r\n            else if (tn === $.STYLE)\r\n                startTagInHead(p, token);\r\n\r\n            else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD)\r\n                tbodyStartTagInTable(p, token);\r\n\r\n            else if (tn === $.INPUT)\r\n                inputStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 6:\r\n            if (tn === $.SCRIPT)\r\n                startTagInHead(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 7:\r\n            if (tn === $.CAPTION)\r\n                captionStartTagInTable(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        case 8:\r\n            if (tn === $.COLGROUP)\r\n                colgroupStartTagInTable(p, token);\r\n\r\n            else if (tn === $.TEMPLATE)\r\n                startTagInHead(p, token);\r\n\r\n            else\r\n                tokenInTable(p, token);\r\n\r\n            break;\r\n\r\n        default:\r\n            tokenInTable(p, token);\r\n    }\r\n\r\n}\r\n\r\nfunction endTagInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TABLE) {\r\n        if (p.openElements.hasInTableScope($.TABLE)) {\r\n            p.openElements.popUntilTagNamePopped($.TABLE);\r\n            p._resetInsertionMode();\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML &&\r\n             tn !== $.TBODY && tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR)\r\n        tokenInTable(p, token);\r\n}\r\n\r\nfunction tokenInTable(p, token) {\r\n    var savedFosterParentingState = p.fosterParentingEnabled;\r\n\r\n    p.fosterParentingEnabled = true;\r\n    p._processTokenInBodyMode(token);\r\n    p.fosterParentingEnabled = savedFosterParentingState;\r\n}\r\n\r\n\r\n//12.2.5.4.10 The \"in table text\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction whitespaceCharacterInTableText(p, token) {\r\n    p.pendingCharacterTokens.push(token);\r\n}\r\n\r\nfunction characterInTableText(p, token) {\r\n    p.pendingCharacterTokens.push(token);\r\n    p.hasNonWhitespacePendingCharacterToken = true;\r\n}\r\n\r\nfunction tokenInTableText(p, token) {\r\n    var i = 0;\r\n\r\n    if (p.hasNonWhitespacePendingCharacterToken) {\r\n        for (; i < p.pendingCharacterTokens.length; i++)\r\n            tokenInTable(p, p.pendingCharacterTokens[i]);\r\n    }\r\n\r\n    else {\r\n        for (; i < p.pendingCharacterTokens.length; i++)\r\n            p._insertCharacters(p.pendingCharacterTokens[i]);\r\n    }\r\n\r\n    p.insertionMode = p.originalInsertionMode;\r\n    p._processToken(token);\r\n}\r\n\r\n\r\n//12.2.5.4.11 The \"in caption\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInCaption(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n        tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\r\n        if (p.openElements.hasInTableScope($.CAPTION)) {\r\n            p.openElements.generateImpliedEndTags();\r\n            p.openElements.popUntilTagNamePopped($.CAPTION);\r\n            p.activeFormattingElements.clearToLastMarker();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInBody(p, token);\r\n}\r\n\r\nfunction endTagInCaption(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.TABLE) {\r\n        if (p.openElements.hasInTableScope($.CAPTION)) {\r\n            p.openElements.generateImpliedEndTags();\r\n            p.openElements.popUntilTagNamePopped($.CAPTION);\r\n            p.activeFormattingElements.clearToLastMarker();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n\r\n            if (tn === $.TABLE)\r\n                p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML && tn !== $.TBODY &&\r\n             tn !== $.TD && tn !== $.TFOOT && tn !== $.TH && tn !== $.THEAD && tn !== $.TR)\r\n        endTagInBody(p, token);\r\n}\r\n\r\n\r\n//12.2.5.4.12 The \"in column group\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInColumnGroup(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.COL)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        startTagInHead(p, token);\r\n\r\n    else\r\n        tokenInColumnGroup(p, token);\r\n}\r\n\r\nfunction endTagInColumnGroup(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.COLGROUP) {\r\n        if (p.openElements.currentTagName === $.COLGROUP) {\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n\r\n    else if (tn !== $.COL)\r\n        tokenInColumnGroup(p, token);\r\n}\r\n\r\nfunction tokenInColumnGroup(p, token) {\r\n    if (p.openElements.currentTagName === $.COLGROUP) {\r\n        p.openElements.pop();\r\n        p.insertionMode = IN_TABLE_MODE;\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\n//12.2.5.4.13 The \"in table body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInTableBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TR) {\r\n        p.openElements.clearBackToTableBodyContext();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_ROW_MODE;\r\n    }\r\n\r\n    else if (tn === $.TH || tn === $.TD) {\r\n        p.openElements.clearBackToTableBodyContext();\r\n        p._insertFakeElement($.TR);\r\n        p.insertionMode = IN_ROW_MODE;\r\n        p._processToken(token);\r\n    }\r\n\r\n    else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP ||\r\n             tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n\r\n        if (p.openElements.hasTableBodyContextInTableScope()) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInTable(p, token);\r\n}\r\n\r\nfunction endTagInTableBody(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TABLE) {\r\n        if (p.openElements.hasTableBodyContextInTableScope()) {\r\n            p.openElements.clearBackToTableBodyContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP ||\r\n             tn !== $.HTML && tn !== $.TD && tn !== $.TH && tn !== $.TR)\r\n        endTagInTable(p, token);\r\n}\r\n\r\n//12.2.5.4.14 The \"in row\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInRow(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TH || tn === $.TD) {\r\n        p.openElements.clearBackToTableRowContext();\r\n        p._insertElement(token, NS.HTML);\r\n        p.insertionMode = IN_CELL_MODE;\r\n        p.activeFormattingElements.insertMarker();\r\n    }\r\n\r\n    else if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n             tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\r\n        if (p.openElements.hasInTableScope($.TR)) {\r\n            p.openElements.clearBackToTableRowContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_BODY_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInTable(p, token);\r\n}\r\n\r\nfunction endTagInRow(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TR) {\r\n        if (p.openElements.hasInTableScope($.TR)) {\r\n            p.openElements.clearBackToTableRowContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_BODY_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TABLE) {\r\n        if (p.openElements.hasInTableScope($.TR)) {\r\n            p.openElements.clearBackToTableRowContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_BODY_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD) {\r\n        if (p.openElements.hasInTableScope(tn) || p.openElements.hasInTableScope($.TR)) {\r\n            p.openElements.clearBackToTableRowContext();\r\n            p.openElements.pop();\r\n            p.insertionMode = IN_TABLE_BODY_MODE;\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP ||\r\n             tn !== $.HTML && tn !== $.TD && tn !== $.TH)\r\n        endTagInTable(p, token);\r\n}\r\n\r\n\r\n//12.2.5.4.15 The \"in cell\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInCell(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.COL || tn === $.COLGROUP || tn === $.TBODY ||\r\n        tn === $.TD || tn === $.TFOOT || tn === $.TH || tn === $.THEAD || tn === $.TR) {\r\n\r\n        if (p.openElements.hasInTableScope($.TD) || p.openElements.hasInTableScope($.TH)) {\r\n            p._closeTableCell();\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        startTagInBody(p, token);\r\n}\r\n\r\nfunction endTagInCell(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.TD || tn === $.TH) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p.openElements.generateImpliedEndTags();\r\n            p.openElements.popUntilTagNamePopped(tn);\r\n            p.activeFormattingElements.clearToLastMarker();\r\n            p.insertionMode = IN_ROW_MODE;\r\n        }\r\n    }\r\n\r\n    else if (tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD || tn === $.TR) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p._closeTableCell();\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn !== $.BODY && tn !== $.CAPTION && tn !== $.COL && tn !== $.COLGROUP && tn !== $.HTML)\r\n        endTagInBody(p, token);\r\n}\r\n\r\n//12.2.5.4.16 The \"in select\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInSelect(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.OPTION) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p.openElements.pop();\r\n\r\n        p._insertElement(token, NS.HTML);\r\n    }\r\n\r\n    else if (tn === $.OPTGROUP) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p.openElements.pop();\r\n\r\n        if (p.openElements.currentTagName === $.OPTGROUP)\r\n            p.openElements.pop();\r\n\r\n        p._insertElement(token, NS.HTML);\r\n    }\r\n\r\n    else if (tn === $.INPUT || tn === $.KEYGEN || tn === $.TEXTAREA || tn === $.SELECT) {\r\n        if (p.openElements.hasInSelectScope($.SELECT)) {\r\n            p.openElements.popUntilTagNamePopped($.SELECT);\r\n            p._resetInsertionMode();\r\n\r\n            if (tn !== $.SELECT)\r\n                p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else if (tn === $.SCRIPT || tn === $.TEMPLATE)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagInSelect(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.OPTGROUP) {\r\n        var prevOpenElement = p.openElements.items[p.openElements.stackTop - 1],\r\n            prevOpenElementTn = prevOpenElement && p.treeAdapter.getTagName(prevOpenElement);\r\n\r\n        if (p.openElements.currentTagName === $.OPTION && prevOpenElementTn === $.OPTGROUP)\r\n            p.openElements.pop();\r\n\r\n        if (p.openElements.currentTagName === $.OPTGROUP)\r\n            p.openElements.pop();\r\n    }\r\n\r\n    else if (tn === $.OPTION) {\r\n        if (p.openElements.currentTagName === $.OPTION)\r\n            p.openElements.pop();\r\n    }\r\n\r\n    else if (tn === $.SELECT && p.openElements.hasInSelectScope($.SELECT)) {\r\n        p.openElements.popUntilTagNamePopped($.SELECT);\r\n        p._resetInsertionMode();\r\n    }\r\n\r\n    else if (tn === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\n//12.2.5.4.17 The \"in select in table\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInSelectInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT ||\r\n        tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\r\n        p.openElements.popUntilTagNamePopped($.SELECT);\r\n        p._resetInsertionMode();\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        startTagInSelect(p, token);\r\n}\r\n\r\nfunction endTagInSelectInTable(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.CAPTION || tn === $.TABLE || tn === $.TBODY || tn === $.TFOOT ||\r\n        tn === $.THEAD || tn === $.TR || tn === $.TD || tn === $.TH) {\r\n        if (p.openElements.hasInTableScope(tn)) {\r\n            p.openElements.popUntilTagNamePopped($.SELECT);\r\n            p._resetInsertionMode();\r\n            p._processToken(token);\r\n        }\r\n    }\r\n\r\n    else\r\n        endTagInSelect(p, token);\r\n}\r\n\r\n//12.2.5.4.18 The \"in template\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInTemplate(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.BASE || tn === $.BASEFONT || tn === $.BGSOUND || tn === $.LINK || tn === $.META ||\r\n        tn === $.NOFRAMES || tn === $.SCRIPT || tn === $.STYLE || tn === $.TEMPLATE || tn === $.TITLE)\r\n        startTagInHead(p, token);\r\n\r\n    else {\r\n        var newInsertionMode = TEMPLATE_INSERTION_MODE_SWITCH_MAP[tn] || IN_BODY_MODE;\r\n\r\n        p._popTmplInsertionMode();\r\n        p._pushTmplInsertionMode(newInsertionMode);\r\n        p.insertionMode = newInsertionMode;\r\n        p._processToken(token);\r\n    }\r\n}\r\n\r\nfunction endTagInTemplate(p, token) {\r\n    if (token.tagName === $.TEMPLATE)\r\n        endTagInHead(p, token);\r\n}\r\n\r\nfunction eofInTemplate(p, token) {\r\n    if (p.openElements.tmplCount > 0) {\r\n        p.openElements.popUntilTagNamePopped($.TEMPLATE);\r\n        p.activeFormattingElements.clearToLastMarker();\r\n        p._popTmplInsertionMode();\r\n        p._resetInsertionMode();\r\n        p._processToken(token);\r\n    }\r\n\r\n    else\r\n        p.stopped = true;\r\n}\r\n\r\n\r\n//12.2.5.4.19 The \"after body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterBody(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else\r\n        tokenAfterBody(p, token);\r\n}\r\n\r\nfunction endTagAfterBody(p, token) {\r\n    if (token.tagName === $.HTML) {\r\n        if (!p.fragmentContext)\r\n            p.insertionMode = AFTER_AFTER_BODY_MODE;\r\n    }\r\n\r\n    else\r\n        tokenAfterBody(p, token);\r\n}\r\n\r\nfunction tokenAfterBody(p, token) {\r\n    p.insertionMode = IN_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n//12.2.5.4.20 The \"in frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagInFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.FRAMESET)\r\n        p._insertElement(token, NS.HTML);\r\n\r\n    else if (tn === $.FRAME)\r\n        p._appendElement(token, NS.HTML);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagInFrameset(p, token) {\r\n    if (token.tagName === $.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\r\n        p.openElements.pop();\r\n\r\n        if (!p.fragmentContext && p.openElements.currentTagName !== $.FRAMESET)\r\n            p.insertionMode = AFTER_FRAMESET_MODE;\r\n    }\r\n}\r\n\r\n//12.2.5.4.21 The \"after frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\nfunction endTagAfterFrameset(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        p.insertionMode = AFTER_AFTER_FRAMESET_MODE;\r\n}\r\n\r\n//12.2.5.4.22 The \"after after body\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterAfterBody(p, token) {\r\n    if (token.tagName === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else\r\n        tokenAfterAfterBody(p, token);\r\n}\r\n\r\nfunction tokenAfterAfterBody(p, token) {\r\n    p.insertionMode = IN_BODY_MODE;\r\n    p._processToken(token);\r\n}\r\n\r\n//12.2.5.4.23 The \"after after frameset\" insertion mode\r\n//------------------------------------------------------------------\r\nfunction startTagAfterAfterFrameset(p, token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.HTML)\r\n        startTagInBody(p, token);\r\n\r\n    else if (tn === $.NOFRAMES)\r\n        startTagInHead(p, token);\r\n}\r\n\r\n\r\n//12.2.5.5 The rules for parsing tokens in foreign content\r\n//------------------------------------------------------------------\r\nfunction nullCharacterInForeignContent(p, token) {\r\n    token.chars = UNICODE.REPLACEMENT_CHARACTER;\r\n    p._insertCharacters(token);\r\n}\r\n\r\nfunction characterInForeignContent(p, token) {\r\n    p._insertCharacters(token);\r\n    p.framesetOk = false;\r\n}\r\n\r\nfunction startTagInForeignContent(p, token) {\r\n    if (foreignContent.causesExit(token) && !p.fragmentContext) {\r\n        while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== NS.HTML && !p._isIntegrationPoint(p.openElements.current))\r\n            p.openElements.pop();\r\n\r\n        p._processToken(token);\r\n    }\r\n\r\n    else {\r\n        var current = p._getAdjustedCurrentElement(),\r\n            currentNs = p.treeAdapter.getNamespaceURI(current);\r\n\r\n        if (currentNs === NS.MATHML)\r\n            foreignContent.adjustTokenMathMLAttrs(token);\r\n\r\n        else if (currentNs === NS.SVG) {\r\n            foreignContent.adjustTokenSVGTagName(token);\r\n            foreignContent.adjustTokenSVGAttrs(token);\r\n        }\r\n\r\n        foreignContent.adjustTokenXMLAttrs(token);\r\n\r\n        if (token.selfClosing)\r\n            p._appendElement(token, currentNs);\r\n        else\r\n            p._insertElement(token, currentNs);\r\n    }\r\n}\r\n\r\nfunction endTagInForeignContent(p, token) {\r\n    for (var i = p.openElements.stackTop; i > 0; i--) {\r\n        var element = p.openElements.items[i];\r\n\r\n        if (p.treeAdapter.getNamespaceURI(element) === NS.HTML) {\r\n            p._processToken(token);\r\n            break;\r\n        }\r\n\r\n        if (p.treeAdapter.getTagName(element).toLowerCase() === token.tagName) {\r\n            p.openElements.popUntilElementPopped(element);\r\n            break;\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"script"}